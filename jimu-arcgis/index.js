define(["jimu-core"],(function(e){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=11)}([function(t,i){t.exports=e},function(e,t,i){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Map="MAP",e.WebMap="WEB_MAP",e.WebScene="WEB_SCENE",e.FeatureLayer="FEATURE_LAYER"}(r=t.DataSourceTypes||(t.DataSourceTypes={})),t.ArcGISDataSourceTypes=r,function(e){e.BaseDynamicLayer="base-dynamic",e.BaseElevationLayer="base-elevation",e.BaseTileLayer="base-tile",e.BuildingSceneLayer="building-scene",e.CSVLayer="csv",e.ElevationLayer="elevation",e.FeatureLayer="feature",e.GeoJSONLayer="geojson",e.GeoRSSLayer="geo-rss",e.GraphicsLayer="graphics",e.GroupLayer="group",e.ImageryLayer="imagery",e.IntegratedMeshLayer="integrated-mesh",e.KMLLayer="kml",e.MapImageLayer="map-image",e.MapNotesLayer="map-notes",e.PointCloudLayer="point-cloud",e.SceneLayer="scene",e.TileLayer="tile",e.UnknownLayer="unknown",e.UnsupportedLayer="unsupported",e.VectorTileLayer="vector-tile",e.WMSLayer="wms",e.WMTSLayer="wmts",e.WebTileLayer="web-tile"}(t.LayerTypes||(t.LayerTypes={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),a=i(8),n=i(9),o=function(){function e(){this.jimuMapViewGroups={}}return e.getInstance=function(){return window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._mapViewManager:(e._instance||(e._instance=new e,window._mapViewManager=e._instance),e._instance)},e.prototype.getJimuMapViewById=function(e){var t=Object.keys(this.jimuMapViewGroups);if(0===t.length)return null;for(var i=0;i<t.length;i++){var r=t[i];if(Object.keys(this.jimuMapViewGroups[r].jimuMapViews).indexOf(e)>-1)return this.jimuMapViewGroups[r].jimuMapViews[e]}return null},e.prototype.getJimuMapViewGroup=function(e){return this.jimuMapViewGroups[e]?this.jimuMapViewGroups[e]:null},e.prototype.createJimuMapView=function(e){var t=e.mapWidgetId+"-"+e.datasourceId;if(this.getJimuMapViewById(t))return Promise.resolve(this.getJimuMapViewById(t));var i=new a.JimuMapView(e);return this.addJimuMapView(i),i.whenJimuMapViewLoaded()},e.prototype.addJimuMapView=function(e){if(this.jimuMapViewGroups[e.mapWidgetId])this.jimuMapViewGroups[e.mapWidgetId].addJimuMapView(e);else{var t=new n.JimuMapViewGroup(e.mapWidgetId);t.addJimuMapView(e),this.jimuMapViewGroups[e.mapWidgetId]=t}r.getAppStore().dispatch(r.appActions.jimuMapViewAdded(e.id,r.Immutable({id:e.id,mapWidgetId:e.mapWidgetId,datasourceId:e.datasourceId,status:e.status})))},e.prototype.setJimuMapView=function(e){if(this.jimuMapViewGroups[e.mapWidgetId])this.jimuMapViewGroups[e.mapWidgetId].setJimuMapView(e);else{var t=new n.JimuMapViewGroup(e.mapWidgetId);t.addJimuMapView(e),this.jimuMapViewGroups[e.mapWidgetId]=t}r.getAppStore().dispatch(r.appActions.jimuMapViewUpdated(e.id,r.Immutable({id:e.id,mapWidgetId:e.mapWidgetId,datasourceId:e.datasourceId,isActive:e.isActive,status:e.status})))},e.prototype.destroyJimuMapView=function(e){var t=this.getJimuMapViewById(e);t&&t.destroy();var i=Object.keys(this.jimuMapViewGroups);if(0!==i.length)for(var a=0;a<i.length;a++){var n=i[a];if(Object.keys(this.jimuMapViewGroups[n].jimuMapViews).indexOf(e)>-1){delete this.jimuMapViewGroups[n].jimuMapViews[e],0===Object.keys(this.jimuMapViewGroups[n].jimuMapViews).length&&delete this.jimuMapViewGroups[n],r.getAppStore().dispatch(r.appActions.jimuMapViewRemoved(e));break}}},e}();t.MapViewManager=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),a=function(){function e(e){e.rootJimuLayerId?this.id=e.jimuMapViewId+"-"+e.rootJimuLayerId+"-"+e.jimuLayerId:this.id=e.jimuMapViewId+"-"+e.jimuLayerId,this.view=e.view,this.type=e.type,this.layerDataSourceId=e.layerDataSourceId,this.jimuMapViewId=e.jimuMapViewId,this.jimuLayerId=e.jimuLayerId,this.layer=e.layer,this.layerIndex=e.layerIndex,this.parentJimuLayerViewId=e.parentJimuLayerViewId,this.dataSourceInfoObserver=r.observeStore(this.onLayerDataSourceInfoChange.bind(this),["dataSourcesInfo",this.layerDataSourceId])}return e.prototype.onLayerDataSourceInfoChange=function(e,t){},e.prototype.selectFeaturesByIds=function(e){},e.prototype.selectFeatureById=function(e){},e.prototype.destroy=function(){this.dataSourceInfoObserver&&this.dataSourceInfoObserver()},e}();t.JimuLayerView=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0);t.loadArcGISJSAPIModules=function(e){return r.loadArcGISJSAPIModules(e)}},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),a=i(4);function n(e,t,i,a){var n=new i({url:r.getAppStore().getState().portalSelf.helperServices.geometry.url}),o=new a({geometries:e,outSpatialReference:t});return n.project(o)}t.projectToSpatialReference=function(e,t){return e&&0!==e.length&&e[0]&&t.wkid!==e[0].spatialReference.wkid&&!t.equals(e[0].spatialReference)?a.loadArcGISJSAPIModules(["esri/tasks/GeometryService","esri/tasks/support/ProjectParameters","esri/geometry/projection"]).then((function(i){var r,a,o;if(r=i[0],a=i[1],(o=i[2]).isSupported()){if(o.isLoaded()){var s=function(e,t,i){return i.project(e,t)}(e,t,o);return Promise.resolve(s)}return o.load(),n(e,t,r,a).then((function(e){return Promise.resolve(e)}),(function(e){return console.error(e),Promise.reject(e)}))}return n(e,t,r,a).then((function(e){return Promise.resolve(e)}),(function(e){return console.error(e),Promise.reject(e)}))})):Promise.resolve(e)}},function(e,t,i){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=i(3),u=i(2),p=i(4),c=function(e){function t(t){var i=e.call(this,t)||this;return i.features=[],i.isReservePopup=!1,i.virtualLayer=null,i.selectedIds="",i.localDefinitionExpression="",i.layer&&i.layer.watch("visible",(function(e,t){i.virtualLayer&&(i.virtualLayer.visible=e),i.view||i.highLightSelectedFeaturesWithVirtualLayer()})),i.getViewForMap().popup.watch("selectedFeature",(function(e){if(e){if(!e||!e.layer)return;if(e.layer===i.layer){var t=String(e.attributes[e.layer.objectIdField]);if(t===i.selectedIds)return;var r=i.getLayerDataSource(),a=u.MapViewManager.getInstance().getJimuMapViewById(i.jimuMapViewId);r.queryById(t).then((function(e){i.selectFeatureById(t,e),i.isReservePopup=!0,o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(a.mapWidgetId,[e]))}))}else i.isReservePopup=!1,i.selectFeatureById(null)}})),i.getViewForMap().popup.watch("visible",(function(e){var t=i.getViewForMap();if(!e&&t.popup.selectedFeature&&t.popup.selectedFeature.layer===i.layer){var r=u.MapViewManager.getInstance().getJimuMapViewById(i.jimuMapViewId);o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(r.mapWidgetId,[])),i.isReservePopup=!1,i.selectFeatureById(null)}})),i.getSelectedRecordIds().length>0?i.moveFeatureToCenter(i.getSelectedRecordIds()[0]).then((function(){i.highLightSelectedFeatures()})):i.getLayerDataSource()&&i.getLayerDataSource().getSelectedRecordIds().length>0&&i.moveFeatureToCenter(i.getLayerDataSource().getSelectedRecordIds()[0]).then((function(){i.highLightFeatures(i.getLayerDataSource().getSelectedRecordIds().map((function(e){return parseInt(e)})))}),(function(e){return console.error(e)})),window&&window.jimuConfig&&window.jimuConfig.isInBuilder&&(i.appModeObserver=o.observeStore(i.onAppModeInfoChange.bind(i),["appRuntimeInfo","appMode"])),i}return a(t,e),t.prototype.doQuery=function(e){var t=this;return new Promise((function(i){t.view.updating?(t.updateWatchHandle&&(t.updateWatchHandle.remove(),t.updateWatchHandle=null),t.updateWatchHandle=t.view.watch("updating",(function(r){r||t.view.queryFeatures(e).then((function(e){t.features=e.features,i(t.features)}))}))):t.view.queryFeatures(e).then((function(e){t.features=e.features,i(t.features)}),(function(e){console.error(e)}))}))},t.prototype.doQueryById=function(e){var t={objectIds:[parseInt(e)],returnGeometry:!0};return this.doQuery(t).then((function(e){return e[0]}))},t.prototype.mergeQuery=function(e,t){var i="("+e.where+") and ("+t.where+")";return n(n(n({},e),t),{where:i})},t.prototype.setRefreshIntervalForLayer=function(e){this.view&&null!=e&&(o.getAppStore().getState().appRuntimeInfo.appMode===o.AppMode.Design?this.layer.refreshInterval=0:this.layer.refreshInterval=e/60)},t.prototype.setDefinitionExpressionForLayer=function(e){var t=this;if(e){if(this.view&&this.view.layer){var i={outFields:["*"],where:this.localDefinitionExpression,returnGeometry:!0};if((r=this.getLayerDataSource().getRealQueryParams(i,"query"))&&(this.view.layer.definitionExpression=r.where),e.geometry){if(this.view.filter&&this.view.filter.geometry===e.geometry)return;p.loadArcGISJSAPIModules(["esri/geometry/support/jsonUtils"]).then((function(i){var r=i[0];t.view.filter={geometry:r.fromJSON(e.geometry)}}))}else this.view.filter&&(this.view.filter=null);return}if(!this.view&&this.layer){var r;i={outFields:["*"],where:this.localDefinitionExpression,returnGeometry:!0};return void((r=this.getLayerDataSource().getRealQueryParams(i,"query"))&&(this.layer.definitionExpression=r.where))}}},t.prototype.setLocalDefinitionExpression=function(e){this.localDefinitionExpression=e,this.getLayerDataSource().getCurrentQueryParams()&&this.setDefinitionExpressionForLayer(this.getLayerDataSource().getCurrentQueryParams())},t.prototype.highLightSelectedFeatures=function(){this.view?this.highLightFeatures(this.getSelectedRecordIds().map((function(e){return parseInt(e)}))):this.highLightSelectedFeaturesWithVirtualLayer()},t.prototype.highLightSelectedFeaturesWithVirtualLayer=function(){for(var e=this,t=u.MapViewManager.getInstance().getJimuMapViewById(this.jimuMapViewId),i=t.getParentLayerViews(this.id),r=!0,a=0;a<i.length;a++)if(!i[a].layer.visible){r=!1;break}if(r&&this.layer.visible){this.virtualLayer&&(t.view.map.remove(this.virtualLayer),this.virtualLayer=null,this.clearHighLight());var n=this.getLayerDataSource(),o=n.getSelectedRecords();if(o&&o.length>0){var s=n.layer,c=this.getObjectIdField(s.fields,s.objectIdField),l=[];for(a=0;a<o.length;a++){var d=o[a].feature.clone(),y=d.attributes[s.objectIdField];d.attributes={},d.attributes[s.objectIdField]=y,l.push(d)}p.loadArcGISJSAPIModules(["esri/layers/FeatureLayer"]).then((function(i){var r=i[0];e.virtualLayer=new r({title:s.title,source:l,fields:c?[c]:[],objectIdField:s.objectIdField,renderer:e.getRendererForVirtualLayer(l[0].geometry.type),listMode:"hide",legendEnabled:!1}),t.view.map.add(e.virtualLayer,e.layerIndex),e.virtualLayer.on("layerview-create",(function(t){var i=t.layerView;e.highLightHandle=i.highlight(l)}))}))}}},t.prototype.highLightFeatures=function(e){var t=this;this.highLightHandle&&(this.highLightHandle.remove(),this.highLightHandle=null),this.view&&this.view.when((function(){t.highLightHandle&&(t.highLightHandle.remove(),t.highLightHandle=null),t.highLightHandle=t.view.highlight(e)}))},t.prototype.clearHighLight=function(){(this.highLightHandle&&(this.highLightHandle.remove(),this.highLightHandle=null,this.isReservePopup&&(this.getViewForMap().popup.close(),this.isReservePopup=!1)),this.virtualLayer)&&(u.MapViewManager.getInstance().getJimuMapViewById(this.jimuMapViewId).view.map.remove(this.virtualLayer),this.virtualLayer=null)},t.prototype.selectFeatureById=function(e,t){this.getLayerDataSource().selectRecordById(e,t),null==e?this.clearHighLight():this.highLightSelectedFeatures()},t.prototype.selectFeaturesByIds=function(e,t){this.getLayerDataSource().selectRecordsByIds(e,t),e&&e.length>0?this.highLightSelectedFeatures():this.clearHighLight()},t.prototype.onAppModeInfoChange=function(e,t){var i;this.setRefreshIntervalForLayer(null===(i=this.getLayerDataSource())||void 0===i?void 0:i.getAutoRefreshInterval())},t.prototype.onLayerDataSourceInfoChange=function(e,t){var i,r,a;(null===(i=t.selectedIds)||void 0===i?void 0:i.length)>0||(null===(r=t.selectedIndexes)||void 0===r?void 0:r.length)>0?this.selectedIds!==t.selectedIds.join(",")&&(this.selectedIds=t.selectedIds.join(","),this.highLightSelectedFeatures()):(this.selectedIds="",this.clearHighLight()),this.getLayerDataSource().getCurrentQueryParams()&&this.setDefinitionExpressionForLayer(this.getLayerDataSource().getCurrentQueryParams()),this.setRefreshIntervalForLayer(null===(a=this.getLayerDataSource())||void 0===a?void 0:a.getAutoRefreshInterval())},t.prototype.getViewForMap=function(){var e=u.MapViewManager.getInstance().getJimuMapViewById(this.jimuMapViewId);return e&&e.view},t.prototype.handleFeatureNavigationAtPopUp=function(e){var t=this.getLayerDataSource();this.isReservePopup=!0,t.selectRecordById(e)},t.prototype.moveFeatureToCenter=function(e){var t=this;return this.doQueryById(e).then((function(i){return i||(t.getLayerDataSource()?t.getLayerDataSource().queryById(e).then((function(e){return e&&e.feature})):null)})).then((function(i){if(i){var r=t.getCenterPoint(i.geometry);return r?t.getViewForMap().goTo(r):Promise.reject("Does not find center point.")}return Promise.reject("Dose not find feature."+e)}))},t.prototype.getCenterPoint=function(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}},t.prototype.getSelectedRecordIds=function(){var e=this;return o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId]?o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId].selectedIds?o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId].selectedIds.asMutable():o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId].selectedIndexes?o.getAppStore().getState().dataSourcesInfo[this.layerDataSourceId].selectedIndexes.asMutable().map((function(t){return e.features[t].attributes[e.getIdField()]})):[]:[]},t.prototype.getIdField=function(){var e=this.view.layer.objectIdField;if(!e){var t=this.view.layer.fields.find((function(e){return"oid"===e.type}));t&&(e=t.name)}return e||(e="OBJECTID"),e},t.prototype.getLayerDataSource=function(){return o.DataSourceManager.getInstance().getDataSource(this.layerDataSourceId)},t.prototype.selectRecordsByQuery=function(e){var t=this;return p.loadArcGISJSAPIModules(["esri/layers/FeatureLayer"]).then((function(i){for(var r=u.MapViewManager.getInstance().getJimuMapViewById(t.jimuMapViewId),a=r.getParentLayerViews(t.id),n=!0,s=0;s<a.length;s++)if(!a[s].layer.visible){n=!1;break}if(!n||!t.layer.visible)return Promise.resolve([]);t.virtualLayer&&(r.view.map.remove(t.virtualLayer),t.virtualLayer=null,t.clearHighLight());var p=t.getLayerDataSource();e.geometry=e.geometry.toJSON?e.geometry.toJSON():e.geometry;var c=p.dataSourceManager.createLocalDataSource(p,"view");return c&&c.layer?c.load(e,{widgetId:"view"}).then((function(e){if(e&&e.length>0){for(var t=[],i=[],a=[],n=0;n<e.length;n++)t.push(e[n].getId()),i.push(e[n].feature),a.push(e[n]);return o.MessageManager.getInstance().publishMessage(new o.DataRecordsSelectionChangeMessage(r.mapWidgetId,a)),c.selectRecordsByIds(t),Promise.resolve(i)}return Promise.resolve([])})):Promise.resolve([])}),(function(){return Promise.resolve([])})).then((function(e){(!e||e&&0===e.length)&&t.getLayerDataSource().selectRecordsByIds([]);return Promise.resolve(e)}))},t.prototype.getObjectIdField=function(e,t){for(var i=null,r=0;r<e.length;r++)if(e[r].name===t)return i=e[r];return i},t.prototype.getRendererForVirtualLayer=function(e){return["point","multipoint"].indexOf(e)>-1?{type:"simple",symbol:{type:"simple-marker",style:"circle",color:[0,255,255,1],size:"16px",outline:{color:[0,255,255,1],width:1}}}:["polyline"].indexOf(e)>-1?{type:"simple",symbol:{type:"simple-line",color:[0,255,255,1],width:1,style:"solid"}}:["polygon","extent"].indexOf(e)>-1?{type:"simple",symbol:{type:"simple-fill",color:[0,255,255,0],style:"solid",outline:{color:[0,255,255,1],width:1}}}:["mesh"].indexOf(e)>-1?{type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[0,255,255,1]}}]}}:null},t}(s.JimuLayerView);t.JimuFeatureLayerView=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),a=i(3),n=i(7),o=i(16),s=i(17),u=i(18),p=i(2),c=i(1),l=i(4),d=function(){function e(e){var t=this;this.jimuLayerViewLoadPromises={},this.isEnableHighlight=!0,this.getJimuLayerViewId=function(e,i){var a=r.DataSourceManager.getInstance().getDataSource(e);if(!a)return null;var n=a.getJimuChildId(i)[0];return t.id+"-"+n},this.clearSelectedFeatures=function(){for(var e=t.jimuLayerViews,i=Object.keys(e),a=0;a<i.length;a++){var n=e[i[a]];n.type===c.LayerTypes.FeatureLayer&&n.selectFeaturesByIds([])}r.MessageManager.getInstance().publishMessage(new r.DataRecordsSelectionChangeMessage(t.mapWidgetId,[]))},this.getSelectRecordsByQueryPromise=function(e,t){return e.selectRecordsByQuery(t)},this.id=e.mapWidgetId+"-"+e.datasourceId,this.mapWidgetId=e.mapWidgetId,this.isActive=e.isActive,this.datasourceId=e.datasourceId,this.view=e.view,this.jimuLayerViews={},this.status=r.JimuMapViewStatus.Loading,this.isEnablePopup=void 0===e.isEnablePopup||null===e.isEnablePopup||e.isEnablePopup,this.isEditing=!1,this.initView(this.view)}return e.prototype.startEdit=function(){this.isEditing=!0},e.prototype.exitEdit=function(){this.isEditing=!1},e.prototype.getIsEditing=function(){return this.isEditing},e.prototype.enablePopup=function(){this.isEditing&&!this.isEnablePopup&&this.view&&this.view.popup&&(this.view.popup.autoOpenEnabled=!0,this.isEnablePopup=!0)},e.prototype.disablePopup=function(){this.isEditing&&this.isEnablePopup&&this.view&&this.view.popup&&(this.view.popup.autoOpenEnabled=!1,this.isEnablePopup=!1)},e.prototype.getIsEnablePopup=function(){return this.isEnablePopup},e.prototype.enableHighlight=function(){this.isEditing&&!this.isEnableHighlight&&(this.isEnableHighlight=!0)},e.prototype.disableHighlight=function(){this.isEditing&&this.isEnableHighlight&&(this.isEnableHighlight=!1)},e.prototype.getIsEnableHighlight=function(){return this.isEnableHighlight},e.prototype.setIsActive=function(e){this.isActive=e,p.MapViewManager.getInstance().setJimuMapView(this)},e.prototype.initView=function(e){var t=this;e&&e.when((function(){e.on("click",t.onClick.bind(t))}))},e.prototype.onClick=function(e){var t=this,i={x:e.x,y:e.y};this.view.hitTest(i).then((function(e){if(t.isEnableHighlight&&(e&&e.results&&0!==e.results.length||(t.clearAllJimuLayerViewsSelectRecord(),r.MessageManager.getInstance().publishMessage(new r.DataRecordsSelectionChangeMessage(t.mapWidgetId,[]))),e.results.length)){var i=t.jimuLayerViews,a=Object.keys(i),n=Object.keys(i);if("2d"==t.view.type){var o=!1;t.isEnablePopup||t.isEditing||(o=!0),e.results.forEach((function(e,i){var n=e.graphic;if(n&&n.layer){var s=n.layer.id,u=t.getJimuLayerViewId(t.datasourceId,s),p=t.jimuLayerViews[u];if(p)switch(p.type){case c.LayerTypes.FeatureLayer:if(o&&n.layer.popupEnabled){a.splice(a.indexOf(u),1),p.clearHighLight();var l=String(n.attributes[n.layer.objectIdField]),d=p.getLayerDataSource();p.selectedIds=l,d.queryById(l).then((function(e){p.selectFeatureById(l,e),r.MessageManager.getInstance().publishMessage(new r.DataRecordsSelectionChangeMessage(t.mapWidgetId,[e]))})),o=!1}}}}))}else e.results.forEach((function(e,i){var n=e.graphic;if(n&&n.layer){var o=n.layer.id,s=t.getJimuLayerViewId(t.datasourceId,o),u=t.jimuLayerViews[s];if(u)switch(u.type){case c.LayerTypes.FeatureLayer:if(0===i&&n.layer.popupEnabled){a.splice(a.indexOf(s),1),u.clearHighLight();var p=String(n.attributes[n.layer.objectIdField]),l=u.getLayerDataSource();u.selectedIds=p,l.queryById(p).then((function(e){u.selectFeatureById(p,e),r.MessageManager.getInstance().publishMessage(new r.DataRecordsSelectionChangeMessage(t.mapWidgetId,[e]))}))}}}}));if(a)for(var s=0;s<a.length;s++){var u=t.jimuLayerViews[a[s]];if(u)switch(u.type){case c.LayerTypes.FeatureLayer:u.selectFeaturesByIds([])}}n&&a&&n.length===a.length&&n.length>0&&r.MessageManager.getInstance().publishMessage(new r.DataRecordsSelectionChangeMessage(t.mapWidgetId,[]))}}),(function(){t.clearAllJimuLayerViewsSelectRecord()}))},e.prototype.clearAllJimuLayerViewsSelectRecord=function(){for(var e=this.jimuLayerViews,t=Object.keys(e),i=0;i<t.length;i++){e[t[i]].selectFeaturesByIds([])}},e.prototype.createJimuLayerViews=function(){return this.whenAllJimuLayerViewsLoaded(this.view)},e.prototype.addJimuLayerView=function(e){this.jimuLayerViews[e.id]=e},e.prototype.whenJimuMapViewLoaded=function(){var e=this;return this.jimuMapViewLoadPromise?this.jimuMapViewLoadPromise:this.view?(this.jimuMapViewLoadPromise=this.view.when().then((function(){return e.createJimuLayerViews().then((function(){return e.status=r.JimuMapViewStatus.Loaded,p.MapViewManager.getInstance().setJimuMapView(e),Promise.resolve(e)}))}),(function(t){return console.error(t),e.status=r.JimuMapViewStatus.Failed,p.MapViewManager.getInstance().setJimuMapView(e),Promise.reject(e)})),this.jimuMapViewLoadPromise):(this.status=r.JimuMapViewStatus.Failed,p.MapViewManager.getInstance().setJimuMapView(this),this.jimuMapViewLoadPromise=Promise.reject(this),this.jimuMapViewLoadPromise)},e.prototype.whenAllJimuLayerViewsLoaded=function(e){var t=this,i=[],o=this;return e.map.layers.toArray().map((function(p,l){var d=r.DataSourceManager.getInstance().getDataSource(t.datasourceId);if(d){var y=d.getJimuChildId(r.dataSourceUtils.fixLayerId(p.id))[0];t.maxLayerIndex=e.map.layers.length-1;var h=e.whenLayerView(p).then((function(e){var i=null,o=null,h=d.getDataSourceByLayer(p.id.toString(),r.dataSourceUtils.getUrlByLayer(p),p.id);switch(p.type){case c.LayerTypes.FeatureLayer:i={jimuLayerId:y,rootJimuLayerId:null,layerDataSourceId:h&&h.id,view:e,jimuMapViewId:t.id,type:p.type,layer:p,layerIndex:l,parentJimuLayerViewId:null},o=new n.JimuFeatureLayerView(i),t.addJimuLayerView(o);break;case c.LayerTypes.MapImageLayer:case c.LayerTypes.TileLayer:i={jimuLayerId:y,rootJimuLayerId:null,layerDataSourceId:h&&h.id,view:e,jimuMapViewId:t.id,type:p.type,layer:p,layerIndex:l,parentJimuLayerViewId:null},p.type===c.LayerTypes.MapImageLayer&&(o=new u.JimuMapImageLayerView(i)),p.type===c.LayerTypes.TileLayer&&(o=new s.JimuTileLayerView(i)),t.addJimuLayerView(o);var f=p.sublayers;if(f&&f.length>0)for(var g=0;g<f.length;g++){var m=f.getItemAt(g);t.createJimuLayerViewInSublayers(m,o.id,y,p.id)}break;default:i={jimuLayerId:y,rootJimuLayerId:null,layerDataSourceId:h&&h.id,view:e,jimuMapViewId:t.id,type:p.type,layer:p,layerIndex:l,parentJimuLayerViewId:null},o=new a.JimuLayerView(i),t.addJimuLayerView(o)}return Promise.resolve(o)}),(function(){return Promise.resolve(null)}));i.push(h),o.jimuLayerViewLoadPromises[t.id+"-"+y]=h}})),Promise.all(i)},e.prototype.getParentLayerViews=function(e){var t=[];return this.jimuLayerViews[e]&&this.findParentLayerView(this.jimuLayerViews[e].parentJimuLayerViewId,t),t},e.prototype.findParentLayerView=function(e,t){var i=this.jimuLayerViews;(e||i[e])&&(t.push(i[e]),i[e].parentJimuLayerViewId&&this.findParentLayerView(i[e].parentJimuLayerViewId,t))},e.prototype.getChildLayerViews=function(e){var t=[];return this.findChildLayerView(e,t),t},e.prototype.findChildLayerView=function(e,t){for(var i=this.jimuLayerViews,r=Object.keys(i),a=0;a<r.length;a++)i[r[a]].parentJimuLayerViewId===e&&(t.push(i[r[a]]),this.findChildLayerView(i[r[a]].jimuLayerId,t))},e.prototype.updateMaxLayerIndex=function(){return this.maxLayerIndex=this.maxLayerIndex+1,this.maxLayerIndex},e.prototype.createJimuLayerViewInSublayers=function(e,t,i,a){var s=r.DataSourceManager.getInstance().getDataSource(this.datasourceId);if(e.sublayers&&e.sublayers.length>0){if(!(d=s.getDataSourceByLayer(e.id.toString(),r.dataSourceUtils.getUrlByLayer(e),a)))return;var u={jimuLayerId:e.id,rootJimuLayerId:i,layerDataSourceId:d&&d.id,view:null,url:e.url,jimuMapViewId:this.id,type:c.LayerTypes.GroupLayer,layer:e,parentJimuLayerViewId:t,layerIndex:this.updateMaxLayerIndex()},p=new o.JimuGroupLayerView(u);this.addJimuLayerView(p);for(var l=0;l<e.sublayers.length;l++)this.createJimuLayerViewInSublayers(e.sublayers.getItemAt(l),p.jimuLayerId,i,a)}else{var d;if(!(d=s.getDataSourceByLayer(e.id.toString(),r.dataSourceUtils.getUrlByLayer(e),a)))return;u={jimuLayerId:e.id,rootJimuLayerId:i,layerDataSourceId:d&&d.id,view:null,url:e.url,jimuMapViewId:this.id,type:c.LayerTypes.FeatureLayer,layer:e,parentJimuLayerViewId:t,layerIndex:this.updateMaxLayerIndex()},p=new n.JimuFeatureLayerView(u);this.addJimuLayerView(p)}},e.prototype.getJimuLayerViewLoadPromiseById=function(e){return this.jimuLayerViewLoadPromises[e]},e.prototype.selectFeaturesByGraphic=function(e,t){var i=this;return l.loadArcGISJSAPIModules(["esri/geometry/geometryEngine"]).then((function(r){var a=r[0],n=e.geometry;if("point"===n.type||"polyline"===n.type){var o=2.54*i.view.scale/9600;n=a.buffer(n,10*o,"meters")}for(var s={geometry:n,spatialRelationship:t,returnGeometry:!0,outFields:["*"]},u=i.jimuLayerViews,p=Object.keys(u),l=[],d=0;d<p.length;d++){var y=u[p[d]];if(y.type===c.LayerTypes.FeatureLayer){var h=i.getSelectRecordsByQueryPromise(y,s);l.push(h)}}return Promise.all(l)}))},e.prototype.destroy=function(){for(var e=this.jimuLayerViews,t=Object.keys(e),i=0;i<t.length;i++){e[t[i]].destroy()}if(this.view&&!this.view.destroyed){this.view.graphics&&this.view.graphics.destroyed&&this.view.graphics.destroy(),this.view.container=null,this.view.allLayerViews&&this.view.allLayerViews.destroyed&&this.view.allLayerViews.destroy(),this.view.layerViews&&this.view.layerViews.destroyed&&this.view.layerViews.destroy();var r=this.view.ui;r.exbMapTools&&0!==Object.keys(r.exbMapTools).length&&Object.keys(r.exbMapTools).map((function(e,t){r.exbMapTools[e].destroy()})),r.exbMapTools={},this.view.destroy(),this.view=null}},e}();t.JimuMapView=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.switchMap=function(){return t.mapWidgetInstance?t.mapWidgetInstance.switchMap():Promise.resolve()},this.fullScreenMap=function(){t.mapWidgetInstance&&t.mapWidgetInstance.fullScreenMap()},this.mapWidgetId=e,this.jimuMapViews={}}return e.prototype.setMapWidgetInstance=function(e){this.mapWidgetInstance=e},e.prototype.addJimuMapView=function(e){this.jimuMapViews[e.id]=e},e.prototype.setJimuMapView=function(e){this.jimuMapViews[e.id]=e},e.prototype.removeJimuMapView=function(e){delete this.jimuMapViews[e.id]},e.prototype.getActiveJimuMapView=function(){for(var e=Object.keys(this.jimuMapViews),t=0;t<e.length;t++)if(this.jimuMapViews[e[t]].isActive)return this.jimuMapViews[e[t]];return null},e}();t.JimuMapViewGroup=r},,function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0});var a=i(6);t.geometryUtils=a;var n=i(12);t.zoomToUtils=n;var o=i(13);t.portalUtils=o;var s=i(14);t.defaultMessages=s.default,r(i(15)),r(i(2)),r(i(1)),r(i(19)),r(i(4));var u=i(20);t.JimuMapViewComponent=u.JimuMapViewComponent;var p=i(21);t.JimuLayerViewComponent=p.JimuLayerViewComponent;var c=i(22);t.init=c.init},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a=i(4),n=i(6),o=null;function s(e,t,i,r,o){var s;if(r&&c(r)){if("3d"===e.type&&!o)return n.projectToSpatialReference([r],e.spatialReference).then((function(t){return e.goTo(t)}));s=Promise.resolve(r)}else if(i){if("3d"===e.type&&!o)return e.goTo(i);s=y(e,i)}else s=function(e,t){return"feature"===t.type?function(e,t){var i=t.fullExtent.clone();if(!t.url)return Promise.resolve(i);var r=t.capabilities.query;return r?a.loadArcGISJSAPIModules(["esri/tasks/support/Query"]).then((function(a){var n=new(0,a[0]);return n.where=t.definitionExpression?t.definitionExpression:"1=1",n.outSpatialReference=e.spatialReference,n.returnGeometry=!0,r.supportsExtent?t.queryExtent(n).then((function(e){return e.extent})).catch((function(e){return Promise.resolve(i)})):t.queryFeatures(n).then((function(t){return y(e,t.features)})).catch((function(e){return Promise.resolve(i)}))})).catch((function(e){return Promise.resolve(i)})):Promise.resolve(i)}(e,t):Promise.resolve(t.fullExtent.clone())}(e,t);return s.then((function(t){return n.projectToSpatialReference([t],e.spatialReference).then((function(e){return e&&e[0]}))})).then((function(i){if(!c(i))return Promise.reject(new Error("Invalid extent."));if(o)return i=w(e,i),v(e,i,o).then((function(t){return p(e,t)}));var r=t.minScale||0,n=t.maxScale||0;if(!d(i))return i=function(e,t){var i=e.size[0]/e.size[1],r=t.width/t.height;if(r>i){var a=t.width/i/2;t.ymin=t.center.y-a,t.ymax=t.center.y+a}else if(r<i){var n=t.height*i/2;t.xmin=t.center.x-n,t.xmax=t.center.x+n}return t}(e,i),function(e,t){return a.loadArcGISJSAPIModules(["esri/config","esri/geometry/support/WKIDUnitConversion"]).then((function(i){var r,a;r=i[0],a=i[1];var n,o,s=e.size[0],u=a,p=t.spatialReference;p&&(n=p.wkid,o=p.wkt);var c=null;if(n)c=u.values[u[n]];else if(o&&-1!==o.search(/^PROJCS/i)){var l=/UNIT\[([^\]]+)\]\]$/i.exec(o);l&&l[1]&&(c=parseFloat(l[1].split(",")[1]))}return t.width/s*(c||20015077/180)*39.37*(r.screenDPI||96)})).catch((function(e){return Promise.reject()}))}(e,i).then((function(t){return r>0&&t>r?(r=m(e,r,!0),i=w(e,i),v(e,i,r).then((function(t){return p(e,t)}))):t<n?(n=m(e,n,!1),i=w(e,i),v(e,i,n).then((function(t){return p(e,t)}))):p(e,i)}));var s=g(e,r,n,3);return s?("3d"===e.type&&4513.9887>s&&(s=0===r||4513.9887<r?4513.9887:r),i=w(e,i),v(e,i,s).then((function(t){return p(e,t)}))):void 0})).catch((function(e){return Promise.reject(e)}))}function u(e,t,i){return c(t=t.clone())?n.projectToSpatialReference([t],e.spatialReference).then((function(i){var r=i&&i[0];return r||(r=t),d(r)?function(e,t){var i=g(e,0,0,3);return i?(t=w(e,t),v(e,t,i)):Promise.reject()}(e,r):r})).then((function(t){return i?v(e,t,i):t})).then((function(t){return p(e,t)})).catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("Invalid extent."))}function p(e,t){return e.goTo(t)}function c(e){return e&&l(e.xmin)&&l(e.ymin)&&l(e.xmax)&&l(e.ymax)}function l(e){return 0===e||!!e}function d(e){return e.xmin+r.X===e.xmax-r.X&&e.ymin+r.Y===e.ymax-r.Y}function y(e,t,i){void 0===i&&(i={});var r=t&&t[0]&&t[0].layer;return r&&"scene"===r.type?function(e,t,i){return a.loadArcGISJSAPIModules(["esri/tasks/support/Query"]).then((function(i){var r=i[0];if(t){var a=new r;return a.objectIds=e.map((function(e){return e.attributes[t.objectIdField]})),a.returnGeometry=!0,t.queryExtent(a).then((function(e){return 1===e.count?e.extent.expand(3.5):e.extent.expand(2)}))}return Promise.reject()})).catch((function(e){return Promise.reject(e)}))}(t,r,i.factor):"3d"===e.type?h(t,3):h(t)}function h(e,t){return a.loadArcGISJSAPIModules(["esri/Graphic","esri/geometry/Extent","esri/geometry/Point"]).then((function(i){var a,n,o,s=null,u=e;a=i[0],n=i[1],o=i[2];try{if(u&&1===u.length&&u[0].geometry&&"esri.geometry.Multipoint"===u[0].geometry.declaredClass&&1===u[0].geometry.points.length){var p=u[0].geometry.points[0];u=[new a({geometry:new o({x:p[0],y:p[1],spatialReference:u[0].geometry.spatialReference})})]}if(u&&1===u.length&&u[0].geometry&&"esri.geometry.Point"===u[0].geometry.declaredClass){var c=u[0].geometry;s=new n({xmin:c.x-r.X,ymin:c.y-r.Y,xmax:c.x+r.X,ymax:c.y+r.Y,spatialReference:c.spatialReference})}else u&&u.length>0&&(s=function(e,t){if(!e||!e.length)return null;var i,r=null,a=e.length;for(i=0;i<a;i++){var n=e[i].geometry;if(n){var o=n.extent;o||"point"!==n.type||null==n.x||null==n.y||(o=new t({xmin:n.x,ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference})),o&&(r=r?r.union(o):o)}}if(!r||r.width<0||r.height<0)return null;return r}(u,n))&&t&&t>0&&(s=s.expand(t));return s}catch(e){return console.error(e),Promise.reject()}})).catch((function(e){return Promise.reject()}))}function f(e){var t=[];return e.map.basemap.baseLayers.forEach((function(e){e&&e.tileInfo&&e.tileInfo.lods&&t.length<e.tileInfo.lods.length&&(t=e.tileInfo.lods)})),0===t.length?o.create().lods:t}function g(e,t,i,r){var a,n=f(e),o=1;if(n){var s=[],u=[];n.forEach((function(e){t>0&&e.scale>t||(e.scale<i?u.push(e.scale):s.push(e.scale))})),s.reverse();var p=void 0;s.length>=1?(o=u.length?u.length/n.length:1,p=Math.floor((s.length-1)/(r/o)),a=s[p]):a=null}else a=0===t?null:(t-i)/r;return a}function m(e,t,i){var r,a=f(e);if(a){if(i){for(r=0;r<a.length;r++)if(a[r].scale<t)return a[r].scale-1;return a[a.length-1].scale-1}for(r=a.length-1;r>=0;r--)if(a[r].scale>t)return a[r].scale+1;return a[0].scale+1}return i?t-1:t+1}function w(e,t){var i=t.width*(e.size[1]/e.size[0])/5;return t.ymin=t.center.y-i,t.ymax=t.center.y+i,t}function v(e,t,i){return a.loadArcGISJSAPIModules(["esri/config","esri/geometry/support/WKIDUnitConversion"]).then((function(r){var a,n;a=r[0],n=r[1];var o,s,u=e.size[0],p=n,c=t.spatialReference;c&&(o=c.wkid,s=c.wkt);var l=null;if(o)l=p.values[p[o]];else if(s&&-1!==s.search(/^PROJCS/i)){var d=/UNIT\[([^\]]+)\]\]$/i.exec(s);d&&d[1]&&(l=parseFloat(d[1].split(",")[1]))}return t.expand(i*u/(39.37*(l||20015077/180)*(a.screenDPI||96))/t.width)})).catch((function(e){return Promise.reject()}))}t.zoomTo=function(e,t,i){return e&&t?(i||(i={}),a.loadArcGISJSAPIModules(["esri/Graphic","esri/geometry/Extent","esri/layers/Layer","esri/layers/support/TileInfo"]).then((function(r){var a,n,p;return a=r[0],n=r[1],p=r[2],o=r[3],t instanceof n?u(e,t,i.scale):Array.isArray(t)&&t.length&&t[0]instanceof a?function(e,t,i){if("3d"===e.type&&!i)return e.goTo(t);return y(e,t).then((function(t){return u(e,t,i)})).catch((function(e){return Promise.reject(e)}))}(e,t,i.scale):t instanceof p?s(e,t,null,null,i.scale):t.layer&&t.layer instanceof p&&t.extent&&t.extent instanceof n?s(e,t.layer,null,t.extent,i.scale):t.layer&&t.layer instanceof p&&Array.isArray(t.graphics)&&t.graphics.length&&t.graphics[0]instanceof a?s(e,t.layer,t.graphics,null,i.scale):Promise.reject(new Error("Invalid target."))}))):Promise.reject(new Error("Invalid target."))},function(e){e[e.X=1e-4]="X",e[e.Y=1e-4]="Y"}(r||(r={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0);t.checkDefaultBaseMapIsExist=function(){var e=r.getAppStore().getState().portalSelf;return!!(e&&e.defaultBasemap&&e.defaultBasemap.baseMapLayers&&e.defaultBasemap.baseMapLayers[0]&&e.defaultBasemap.baseMapLayers[0].url)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={layerIsNotSupported:"This layer type is not supported."}},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(3)),r(i(7)),r(i(8)),r(i(9))},function(e,t,i){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),o=i(2),s=i(1),u=function(e){function t(t){var i=e.call(this,t)||this;return i.url=null,i.url=t.url,i.layer&&i.layer.watch("visible",(function(e){var t=o.MapViewManager.getInstance().getJimuMapViewById(i.jimuMapViewId).getChildLayerViews(i.id);if(t&&t.length>0)for(var r=0;r<t.length;r++)t[r].virtualLayer&&(t[r].virtualLayer.visible=e&&t[r].layer.visible),t[r].view||t[r].type!==s.LayerTypes.FeatureLayer||t[r].highLightSelectedFeaturesWithVirtualLayer()})),i}return a(t,e),t}(n.JimuLayerView);t.JimuGroupLayerView=u},function(e,t,i){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),o=i(2),s=i(1),u=function(e){function t(t){var i=e.call(this,t)||this;return i.url=null,i.url=t.url,i.layer&&i.layer.watch("visible",(function(e){var t=o.MapViewManager.getInstance().getJimuMapViewById(i.jimuMapViewId).getChildLayerViews(i.id);if(t&&t.length>0)for(var r=0;r<t.length;r++)t[r].virtualLayer&&(t[r].virtualLayer.visible=e&&t[r].layer.visible),t[r].view||t[r].type!==s.LayerTypes.FeatureLayer||t[r].highLightSelectedFeaturesWithVirtualLayer()})),i}return a(t,e),t}(n.JimuLayerView);t.JimuTileLayerView=u},function(e,t,i){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),o=i(2),s=i(1),u=function(e){function t(t){var i=e.call(this,t)||this;return i.url=null,i.url=t.url,i.layer&&i.layer.watch("visible",(function(e){var t=o.MapViewManager.getInstance().getJimuMapViewById(i.jimuMapViewId).getChildLayerViews(i.id);if(t&&t.length>0)for(var r=0;r<t.length;r++)t[r].virtualLayer&&(t[r].virtualLayer.visible=e&&t[r].layer.visible),t[r].view||t[r].type!==s.LayerTypes.FeatureLayer||t[r].highLightSelectedFeaturesWithVirtualLayer()})),i}return a(t,e),t}(n.JimuLayerView);t.JimuMapImageLayerView=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),a=i(1),n=function(){function e(){this.id="arcgis-dependency-define"}return e.prototype.getDependencyKey=function(){return"jimu-arcgis"},e.prototype.getResources=function(){var e=window.jimuConfig.arcgisJsApiUrl;if(!r.getAppStore().getState().queryObject.apiurl||(e=r.getAppStore().getState().queryObject.apiurl,this.checkApiUrl(e)))return/\/$/.test(e)||(e+="/"),window.dojoConfig={baseUrl:r.urlUtils.getFixedRootPath(),parseOnLoad:!1,async:!0,tlmSiblingOfDojo:!1,has:{"esri-featurelayer-webgl":1,"dojo-sniff":0,"dojo-cdn":0},locale:window.locale},window.dojoConfig.packages=[{name:"dojo",location:e+"dojo"},{name:"dijit",location:e+"dijit"},{name:"dojox",location:e+"dojox"},{name:"dgrid",location:e+"dgrid"},{name:"esri",location:e+"esri"},{name:"moment",location:e+"moment"},{name:"whatwg-fetch",location:e+"whatwg-fetch",main:"dist/fetch.umd"}],/src\/$/.test(e)?window.dojoConfig.packages=window.dojoConfig.packages.concat([{name:"@dojo",location:e+"node_modules/@dojo"},{name:"tslib",location:e+"node_modules/tslib",main:"tslib"},{name:"cldrjs",location:e+"node_modules/cldrjs",main:"dist/cldr"},{name:"globalize",location:e+"node_modules/globalize",main:"dist/globalize"},{name:"maquette",location:e+"node_modules/maquette",main:"dist/maquette.umd"},{name:"maquette-jsx",location:e+"node_modules/maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"maquette-css-transitions",location:e+"node_modules/maquette-css-transitions",main:"dist/maquette-css-transitions.umd"}]):window.dojoConfig.packages=window.dojoConfig.packages.concat([{name:"@dojo",location:e+"@dojo"},{name:"tslib",location:e+"tslib",main:"tslib"},{name:"cldrjs",location:e+"cldrjs",main:"dist/cldr"},{name:"globalize",location:e+"globalize",main:"dist/globalize"},{name:"maquette",location:e+"maquette",main:"dist/maquette.umd"},{name:"maquette-jsx",location:e+"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"maquette-css-transitions",location:e+"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"}]),[{url:"jimu-arcgis",dependencies:[{url:e+"dojo/dojo.js"},{url:e+"esri/css/main.css"}]}];console.log("Bad apiurl.",e)},e.prototype.checkApiUrl=function(e){return"development"===window.env||(!/^\/\//.test(e)&&!/^https?:\/\//.test(e)||/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(e))},e}();t.ArcGISDependencyDefineExtension=n;var o=function(){function e(){this.id="arcgis-ds-factory"}return e.prototype.getFactoryUri=function(e){if(Object.keys(a.ArcGISDataSourceTypes).map((function(e){return a.ArcGISDataSourceTypes[e]})).indexOf(e)>-1)return"jimu-arcgis/arcgis-data-source"},e}();t.ArcGISDataSourceFactoryUriExtension=o},function(e,t,i){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(2),s=function(e){function t(t){var i=e.call(this,t)||this;i.viewManager=o.MapViewManager.getInstance(),i.onViewInfosChange=function(e,t){if(e){var r=i.getActiveViewId(),a=i.getViewIdsFromUseMapWidgetIds(t,e),n=i.getWhetherViewCreated(r,e),o=i.getWhetherAllViewsCreated(a,e);i.setState({activeViewId:r,isActiveViewCreated:n,areAllViewsCreated:o})}},i.onViewsCreate=function(e){e&&i.state.activeViewId&&Object.keys(e).some((function(e){return e===i.state.activeViewId}))&&i.setState({isActiveViewCreated:!0}),i.props.onViewsCreate&&i.props.onViewsCreate(e)},i.onViewGroupCreate=function(){if(i.props.onViewGroupCreate&&i.viewManager&&i.props.useMapWidgetIds&&i.props.useMapWidgetIds[0]){var e=i.viewManager.getJimuMapViewGroup(i.props.useMapWidgetIds[0]);i.props.onViewGroupCreate(e)}},i.getActiveViewId=function(){var e=i.props.useMapWidgetIds&&i.props.useMapWidgetIds[0],t=i.viewManager.getJimuMapViewGroup(e),r=t&&t.getActiveJimuMapView();return r&&r.id||null},i.getWhetherAllViewsCreated=function(e,t){return void 0===e&&(e=[]),e.length>0&&!e.some((function(e){return!i.getWhetherViewCreated(e,t)}))},i.getWhetherViewCreated=function(e,t){return!e||!!(e&&t&&t[e]&&t[e].status&&t[e].status===n.JimuMapViewStatus.Loaded)},i.getViewIdsFromUseMapWidgetIds=function(e,t){var r=[];return e&&e.forEach((function(e){r=r.concat(i.getViewIdsFromMapWidgetId(e,t))})),r},i.getViewIdsFromMapWidgetId=function(e,t){return t?Object.keys(t).filter((function(i){return t[i].mapWidgetId===e})):[]},i.getViews=function(e){if(!e)return null;var t={};return e.forEach((function(e){t[e]=i.viewManager.getJimuMapViewById(e)})),t};var r=i.getViewIdsFromUseMapWidgetIds(i.props.useMapWidgetIds,i.props.viewInfos),a=i.getActiveViewId();return i.state={activeViewId:a,isActiveViewCreated:i.getWhetherViewCreated(a,i.props.viewInfos),areAllViewsCreated:i.getWhetherAllViewsCreated(r,i.props.viewInfos)},i}return a(t,e),t.prototype.componentDidMount=function(){if(this.onViewsCreate&&this.state.areAllViewsCreated){var e=this.getViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos),t=this.getViews(e);this.onViewsCreate(t),this.onViewGroupCreate()}if(this.props.onActiveViewChange&&this.state.isActiveViewCreated){var i=this.viewManager&&this.viewManager.getJimuMapViewById(this.state.activeViewId)||null;this.props.onActiveViewChange(i,null)}},t.prototype.componentDidUpdate=function(e,t){if(this.props.viewInfos===e.viewInfos&&this.props.useMapWidgetIds===e.useMapWidgetIds||this.onViewInfosChange(this.props.viewInfos,this.props.useMapWidgetIds),this.props.onActiveViewChange&&this.state.isActiveViewCreated&&(!t.isActiveViewCreated||this.state.activeViewId!==t.activeViewId)){var i=this.viewManager&&this.viewManager.getJimuMapViewById(this.state.activeViewId)||null;this.props.onActiveViewChange(i,t.activeViewId)}if(this.onViewsCreate&&this.state.areAllViewsCreated&&(!t.areAllViewsCreated||this.props.useMapWidgetIds!==e.useMapWidgetIds)){var r=this.getViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos),a=this.getViews(r);this.onViewsCreate(a),this.onViewGroupCreate()}},t.prototype.render=function(){if(!this.props.useMapWidgetIds||!this.props.viewInfos||!this.props.children)return null;var e=this.getViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos),t=this.getViews(e);return"function"==typeof this.props.children?this.props.children(t):this.props.children},t}(n.React.PureComponent);t.JimuMapViewComponent=n.ReactRedux.connect((function(e,t){return e.appStateInBuilder?{viewInfos:e.appStateInBuilder&&e.appStateInBuilder.jimuMapViewsInfo}:{viewInfos:e&&e.jimuMapViewsInfo}}))(s)},function(e,t,i){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(2),s=function(e){function t(t){var i=e.call(this,t)||this;return i.getJimuMapViewIdsFromUseMapWidgetIds=function(e,t,r){var a=[];return e&&e.forEach((function(e){a=a.concat(i.getJimuMapViewIdsFromMapWidgetId(e,t,r))})),a},i.getJimuMapViewIdsFromMapWidgetId=function(e,t,i){return i&&t?Object.keys(t).filter((function(r){return t[r].mapWidgetId===e&&t[r].datasourceId===i})):[]},i}return a(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.getJimuMapViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos,this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.rootDatasourceId);if(t[0]&&this.props.viewInfos[t[0]].status===n.JimuMapViewStatus.Loaded&&this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.jimuMapViewId&&this.props.jimuLayerViewInfo.jimuLayerId){var i=o.MapViewManager.getInstance().getJimuMapViewById(t[0]).getJimuLayerViewLoadPromiseById(this.props.jimuLayerViewInfo.jimuMapViewId+"-"+this.props.jimuLayerViewInfo.jimuLayerId);i?i.then((function(t){e.props.onLayerViewCreated&&e.props.onLayerViewCreated(t)}),(function(t){e.props.onLayerViewFailed&&e.props.onLayerViewFailed(t)})):this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)}t[0]&&this.props.viewInfos[t[0]].status===n.JimuMapViewStatus.Failed&&this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.jimuMapViewId&&this.props.jimuLayerViewInfo.jimuLayerId&&this.props.onLayerViewFailed&&this.props.onLayerViewFailed(null)},t.prototype.componentDidUpdate=function(e,t){var i=this,r=this.getJimuMapViewIdsFromUseMapWidgetIds(e.useMapWidgetIds,e.viewInfos,e.jimuLayerViewInfo&&e.jimuLayerViewInfo.rootDatasourceId),a=e.viewInfos[r[0]],s=a&&a.status,u=this.getJimuMapViewIdsFromUseMapWidgetIds(this.props.useMapWidgetIds,this.props.viewInfos,this.props.jimuLayerViewInfo&&this.props.jimuLayerViewInfo.rootDatasourceId),p=this.props.viewInfos[u[0]],c=p&&p.status;if(s!==c||s===c&&r.join("")===u.join(""))if(p){if(p.status===n.JimuMapViewStatus.Loaded){var l=o.MapViewManager.getInstance().getJimuMapViewById(u[0]).getJimuLayerViewLoadPromiseById(this.props.jimuLayerViewInfo.jimuMapViewId+"-"+this.props.jimuLayerViewInfo.jimuLayerId);l?l.then((function(e){i.props.onLayerViewCreated&&i.props.onLayerViewCreated(e)}),(function(e){i.props.onLayerViewFailed&&i.props.onLayerViewFailed(e)})):this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)}p.status===n.JimuMapViewStatus.Failed&&this.props.onLayerViewFailed&&this.props.onLayerViewFailed(null)}else this.props.onLayerViewCreated&&this.props.onLayerViewCreated(null)},t.prototype.render=function(){return null},t}(n.React.PureComponent);t.JimuLayerViewComponent=n.ReactRedux.connect((function(e,t){return{viewInfos:e&&e.jimuMapViewsInfo}}))(s)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=function(){return Promise.resolve()}}])}));