/* @preserve
* @esri/arcgis-rest-request - v2.13.0 - Apache-2.0
* Copyright (c) 2017-2020 Esri, Inc.
* Wed May 06 2020 21:29:29 GMT-0700 (Pacific Daylight Time)
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).arcgisRest=e.arcgisRest||{})}(this,function(e){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var h=function(){return(h=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function p(r){return Object.keys(r).some(function(e){var t=r[e];if(!t)return!1;switch(t&&t.toParam&&(t=t.toParam()),t.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}})}function a(o){var n={};return Object.keys(o).forEach(function(e){var t=o[e];if(t&&t.toParam&&(t=t.toParam()),t||0===t||"boolean"==typeof t||"string"==typeof t){var r;switch(t.constructor.name){case"Array":r=t[0]&&t[0].constructor&&"Object"===t[0].constructor.name?JSON.stringify(t):t.join(",");break;case"Object":r=JSON.stringify(t);break;case"Date":r=t.valueOf();break;case"Function":r=null;break;case"Boolean":r=t+"";break;default:r=t}!r&&0!==r&&"string"!=typeof r||(n[e]=r)}}),n}function o(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}function d(e){var t=a(e);return Object.keys(t).map(function(e){return o(e,t[e])}).join("&")}function l(e,t){var r=p(e)||t,o=a(e);if(r){var n=new FormData;return Object.keys(o).forEach(function(e){if("undefined"!=typeof Blob&&o[e]instanceof Blob){var t=o.fileName||o[e].name||e;n.append(e,o[e],t)}else n.append(e,o[e])}),n}return d(e)}var m=function(e,t,r,o,n){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=o,this.options=n};function n(e){console&&console.warn&&console.warn.apply(console,[e])}m.prototype=Object.create(Error.prototype),m.prototype.constructor=m;var O="@esri/arcgis-rest-js",v={httpMethod:"POST",params:{f:"json"}};var t,s,i,c,f=(r(t=y,s=i=m),void(t.prototype=null===s?Object.create(s):(u.prototype=s.prototype,new u)),y.prototype.retry=function(e,o){var n=this;void 0===o&&(o=3);var a=0,s=function(t,r){e(n.url,n.options).then(function(e){var t=h({},n.options,{authentication:e});return a+=1,g(n.url,t)}).then(function(e){t(e)}).catch(function(e){"ArcGISAuthError"===e.name&&a<o?s(t,r):"ArcGISAuthError"===e.name&&o<=a?r(n):r(e)})};return new Promise(function(e,t){s(e,t)})},y);function u(){this.constructor=t}function y(e,t,r,o,n){void 0===e&&(e="AUTHENTICATION_ERROR"),void 0===t&&(t="AUTHENTICATION_ERROR_CODE");var a=i.call(this,e,t,r,o,n)||this;return a.name="ArcGISAuthError",a.message="AUTHENTICATION_ERROR_CODE"===t?e:t+": "+e,a}function E(t,e,r,o,n){if(400<=t.code){var a=t.message,s=t.code;throw new m(a,s,t,e,o)}if(t.error){var i=t.error,c=(a=i.message,s=i.code,i.messageCode),u=c||s||"UNKNOWN_ERROR_CODE";if(498===s||499===s||"GWM_0003"===c||400===s&&"Unable to generate token."===a)throw n||new f(a,u,t,e,o);throw new m(a,u,t,e,o)}if("failed"!==t.status&&"failure"!==t.status)return t;a=void 0,s="UNKNOWN_ERROR_CODE";try{a=JSON.parse(t.statusMessage).message,s=JSON.parse(t.statusMessage).code}catch(e){a=t.statusMessage||t.message}throw new m(a,s,t,e,o)}function g(n,e){void 0===e&&(e={params:{f:"json"}});var a=h({httpMethod:"POST"},v,e,{params:h({},v.params,e.params),headers:h({},v.headers,e.headers)}),t=[],r=[];if(a.fetch||"undefined"==typeof fetch?(t.push("`fetch`"),r.push("`node-fetch`")):a.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(t.push("`Promise`"),r.push("`es6-promise`")),"undefined"==typeof FormData&&(t.push("`FormData`"),r.push("`isomorphic-form-data`")),!a.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+t.join(", ")+". We recommend installing the "+r.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var o=a.httpMethod,s=a.authentication,i=a.rawResponse,c=h({f:"json"},a.params),u=null,f={method:o,credentials:"same-origin"};return(s?s.getToken(n,{fetch:a.fetch}).catch(function(e){return e.url=n,e.options=a,u=e,Promise.resolve("")}):Promise.resolve("")).then(function(e){e.length&&(c.token=e);var t={};if("GET"===f.method){c.token&&a.hideToken&&(t["X-Esri-Authorization"]="Bearer "+c.token,delete c.token);var r=""===d(c)?n:n+"?"+d(c);a.maxUrlLength&&r.length>a.maxUrlLength?(f.method="POST",e.length&&a.hideToken&&(c.token=e,delete t["X-Esri-Authorization"])):n=r}var o=new RegExp("/items/.+/updateResources").test(n);return"POST"===f.method&&(f.body=l(c,o)),f.headers=h({},t,a.headers),"undefined"!=typeof window||f.headers.referer||(f.headers.referer=O),p(c)||o||(f.headers["Content-Type"]="application/x-www-form-urlencoded"),a.fetch(n,f)}).then(function(e){if(!e.ok){var t=e.status,r=e.statusText;throw new m(r,"HTTP "+t,e,n,a)}if(i)return e;switch(c.f){case"json":case"geojson":return e.json();case"html":case"text":return e.text();default:return e.blob()}}).then(function(e){if("json"!==c.f&&"geojson"!==c.f||i)return e;var t=E(e,n,0,a,u);if(u){var r=n.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];a.authentication.trustedServers[r]={token:[],expires:new Date(Date.now()+864e5)},u=null}return t})}(c=e.ErrorTypes||(e.ErrorTypes={})).ArcGISRequestError="ArcGISRequestError",c.ArcGISAuthError="ArcGISAuthError",e.ArcGISAuthError=f,e.ArcGISRequestError=m,e.NODEJS_DEFAULT_REFERER_HEADER=O,e.appendCustomParams=function(r,e,t){var o=h({params:{}},t,r);return o.params=e.reduce(function(e,t){return!r[t]&&"boolean"!=typeof r[t]||(e[t]=r[t]),e},o.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce(function(e,t){return o[t]&&(e[t]=o[t]),e},{})},e.checkForErrors=E,e.cleanUrl=function(e){return"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e},e.encodeFormData=l,e.encodeParam=o,e.encodeQueryString=d,e.processParams=a,e.request=g,e.requiresFormData=p,e.setDefaultRequestOptions=function(e,t){e.authentication&&!t&&n("You should not set `authentication` as a default in a shared environment such as a web server which will process multiple users requests. You can call `setDefaultRequestOptions` with `true` as a second argument to disable this warning."),v=e},e.warn=n,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=request.umd.min.js.map
