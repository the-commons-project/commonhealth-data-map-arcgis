define(["jimu-core"],(function(e){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(o,a,function(t){return e[t]}.bind(null,a));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=246)}({134:function(e,t,r){"use strict";function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});var a=r(23),i=r(4),n=r(82);t.FeatureDataRecordImpl=n.FeatureDataRecordImpl;var u=r(251);t.CsvDataSourceImpl=u.CsvDataSourceImpl;var s=r(252);t.FeatureLayerDataSourceImpl=s.FeatureLayerDataSourceImpl;var c=r(253);t.FeatureServiceDataSourceImpl=c.FeatureServiceDataSourceImpl;var l=r(254);t.FeatureSetDataSourceImpl=l.FeatureSetDataSourceImpl;var d=r(255);t.GroupLayerDataSourceImpl=d.GroupLayerDataSourceImpl;var p=r(256);t.MapServiceDataSourceImpl=p.MapServiceDataSourceImpl;var h=r(257);t.SimpleLocalDataSourceImpl=h.SimpleLocalDataSourceImpl;var f=function(){function e(){}return e.prototype.createDataSource=function(e){var t,r,o=null!==(t=e.dataSourceJson)&&void 0!==t?t:e.belongToDataSource.getMainDataSource().getDataSourceJson();return(r=e.dataViewId&&e.dataViewId===a.CONSTANTS.SELECTION_DATA_VIEW_ID?i.DataSourceTypes.FeatureSet:e.dataViewId&&o.dataViews&&o.dataViews[e.dataViewId]&&o.dataViews[e.dataViewId].type||o.type)===i.DataSourceTypes.CSV?new u.CsvDataSourceImpl(e):r===i.DataSourceTypes.FeatureLayer?new s.FeatureLayerDataSourceImpl(e):r===i.DataSourceTypes.FeatureService?new c.FeatureServiceDataSourceImpl(e):r===i.DataSourceTypes.FeatureSet?new l.FeatureSetDataSourceImpl(e):r===i.DataSourceTypes.GroupLayer?new d.GroupLayerDataSourceImpl(e):r===i.DataSourceTypes.MapService?new p.MapServiceDataSourceImpl(e):r===i.DataSourceTypes.SimpleLocal?new h.SimpleLocalDataSourceImpl(e):void console.error("Unimplemented data source type.",o.type)},e}();t.JimuCoreDataSourceFactory=f,o(r(24)),o(r(4))},135:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(23),n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isDataSourceSet=!0,t}return a(t,e),t.prototype.ready=function(){return this._createChildDataSources()},t.prototype.destroy=function(){var e=this;this.getChildDataSources().forEach((function(t){t&&e.dataSourceManager.destroyDataSource(t.id)}))},t.prototype.getChildDataSourceId=function(e){return i.dataSourceUtils.getChildDataSourceId(this.id,e)},t.prototype.getChildDataSources=function(){var e=this;return Object.keys(this.dataSourceManager.getDataSources()).filter((function(t){return e.dataSourceManager.getDataSource(t).parentDataSource===e})).map((function(t){return e.dataSourceManager.getDataSource(t)}))},t.prototype.getChildDataSource=function(e){return this.dataSourceManager.getDataSource(this.getChildDataSourceId(e))},t.prototype.getJimuChildId=function(e){var t=this.getReversedConfigSchema();return t&&t.childSchemas&&t.childSchemas[e]?t.childSchemas[e].map((function(e){return e.jimuChildId})).asMutable():[e]},t}(r(60).AbstractDataSource);t.AbstractSetDataSource=n},14:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(5);t.BREAK_POINTS=[576,992],t.DEFAULT_VIEWPORT_SIZE={DESKTOP:{width:1280,height:800},PAD:{width:768,height:1024},PHONE:{width:414,height:896}},t.DEFAULT_PAGE_WIDTH=960;var a={};a[o.BrowserSizeMode.Large]=[{width:1024,height:768},{width:1280,height:800},{width:1280,height:1024},{width:1366,height:768},{width:1440,height:900},{width:1536,height:864},{width:1600,height:900},{width:1920,height:1080}],a[o.BrowserSizeMode.Medium]=[{width:601,height:962},{width:600,height:1024},{width:768,height:1024},{width:800,height:1280},{width:834,height:1112}],a[o.BrowserSizeMode.Small]=[{width:360,height:640},{width:360,height:720},{width:360,height:740},{width:375,height:667},{width:414,height:736}],t.SCREEN_RESOLUTIONS=a,t.SHARED_THEME="themes/shared-theme/",t.SELECTION_DATA_VIEW_ID="selection",t.DATA_VIEW_ID_FOR_NO_SELECTION="no_selection",t.REPEAT_CONTEXT_DATA_VIEW_ID="repeat_context",t.PROVIDE_REPEATED_DATA_SOURCE_CONTEXT_WIDGET_URI=["widgets/common/list/"],t.CURRENT_PAGE="current_page",t.DEFAULT_QUERY_PAGE_SIZE=100},23:function(t,r){t.exports=e},24:function(e,t,r){"use strict";function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),o(r(60)),o(r(247)),o(r(248)),o(r(249)),o(r(135)),o(r(250))},246:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(134);t.default=o.JimuCoreDataSourceFactory,function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(134))},247:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(23),u=r(4),s=function(e){function t(t){var r=e.call(this,t)||this;return t.layer&&(r.layer=t.layer),r}return a(t,e),t.prototype.ready=function(){var t=this;return this.fetchServiceDefinition().then((function(){return e.prototype.ready.call(t)}))},t.prototype.getServiceDefinition=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getServiceDefinition():this.serviceDefinition},t.prototype._createChildDataSources=function(){var e,t,r=this;return this.layer?t=this.layer.load().then((function(){var e=r.getSubLayers();return Promise.all(e.map((function(e){return r._fetchLayerDefinitionFromSubLayer(e)}))).then((function(t){return t.map((function(t,r){return{def:t,layer:e[r]}})).filter((function(e){return r._getWhetherLayerIsSupported(e.layer,e.def)}))}))})):(null===(e=this.getDataSourceJson())||void 0===e?void 0:e.url)&&(t=n.dataSourceUtils.fetchSupportedLayerDefinitions(this.getDataSourceJson().url,this.getServiceDefinition()).then((function(e){return Object.keys(e).map((function(t){return{def:e[t],url:t}}))}))),t&&(this._childDataSourcesPromise=t.then((function(e){return r._getDsJsonsFromSupportedLayerDefinitions(e&&e.map((function(e){var t;return i(i({},e),{url:null===(t=r.getDataSourceJson())||void 0===t?void 0:t.url})})),r.getDataSourceJson())})).then((function(e){var t=[];return e.forEach((function(e){var o={id:e.dsJson.id,dataSourceJson:e.dsJson.without("jimuChildId"),parentDataSource:r,jimuChildId:e.dsJson.jimuChildId};r.layer&&(o.layer=e.layer),t.push(r.dataSourceManager.createDataSource(o))})),Promise.all(t)}))),this._childDataSourcesPromise},t.prototype.fetchSchema=function(){var e,t,r=this.getChildDataSources(),o=n.Immutable({childSchemas:{},label:(null===(e=this.layer)||void 0===e?void 0:e.title)||(null===(t=this.getServiceDefinition())||void 0===t?void 0:t.name)});return r.map((function(e,t){var r=e.getFetchedSchema(),a=e.getServiceDefinition?e.getServiceDefinition():e.getLayerDefinition&&e.getLayerDefinition();o=o.setIn(["childSchemas",n.dataSourceUtils.fixLayerId((null==a?void 0:a.name)||""+(null==a?void 0:a.id))],r)})),Promise.resolve(o)},t.prototype.fetchServiceDefinition=function(){var e,t=this,r=null===(e=this.getDataSourceJson())||void 0===e?void 0:e.url;return r?this.getServiceDefinition()?Promise.resolve(this.getServiceDefinition()):n.ServiceManager.getInstance().fetchServiceInfo(r).then((function(e){return e.definition})).then((function(e){return e?(t.serviceDefinition=e,e):null})):Promise.resolve(null)},t.prototype.getSubLayers=function(){if(!this.layer)return[];var e=this.layer.sublayers||this.layer.layers;return e?e.toArray():[]},t.prototype.getOriginalDataId=function(){var e,t;return(null===(e=this.layer)||void 0===e?void 0:e.id)||(null===(t=this.serviceDefinition)||void 0===t?void 0:t.id)},t.prototype._getWhetherLayerIsSupported=function(e,t){var r,o,a,i;if((null==t?void 0:t.type)===u.SupportedLayerServiceTypes.FeatureLayer)return!!(null===(r=e)||void 0===r?void 0:r.fields)||!!(null==t?void 0:t.fields);var s=n.dataSourceUtils.getUrlByLayer(e);return n.dataSourceUtils.isSupportedSingleLayerService(s)||n.dataSourceUtils.isSupportedWholeService(s)||(null===(o=e)||void 0===o?void 0:o.type)===u.SupportedLayerTypes.GroupLayer||(null===(a=e)||void 0===a?void 0:a.type)===u.SupportedLayerTypes.MapImageLayer||(null===(i=e)||void 0===i?void 0:i.type)===u.SupportedLayerTypes.TileLayer},t.prototype._fetchLayerDefinitionFromSubLayer=function(e){var t=n.dataSourceUtils.getUrlByLayer(e);return t&&n.dataSourceUtils.isSupportedService(t)?n.ServiceManager.getInstance().fetchServiceInfo(t).then((function(e){return e.definition})):Promise.resolve(null)},t.prototype._getDsJsonsFromSupportedLayerDefinitions=function(e,t){var r=this;if(!e)return[];var o=[];return e.forEach((function(e){var a=n.dataSourceUtils.getUrlByLayer(e.layer)||n.dataSourceUtils.getFullServiceUrl(e.url,e.def,!0);r._getDsJsonsFromSingleLayerDefinition(a,e.def,t).forEach((function(t){o=o.concat({dsJson:t,layer:e.layer})}))})),o},t.prototype._getDsJsonsFromSingleLayerDefinition=function(e,t,r){var o=this;if(!t)return[];var a,i=[];return this.getJimuChildId(n.dataSourceUtils.fixLayerId(t.name||""+t.id)).forEach((function(u){var s,c,l=o.getDataSourceJson().schema?o.getDataSourceJson().schema.childSchemas[u]:null,d=o.getChildDataSourceId(u);n.dataSourceUtils.isSupportedSingleLayerService(e)?a=n.dataSourceUtils.getSingleDsJsonFromLayerDefinition(d,e,t,(null==r?void 0:r.childDataSourceJsons)&&r.childDataSourceJsons[u]?r.childDataSourceJsons[u]:null):n.dataSourceUtils.isSupportedWholeService(e)&&(a=n.dataSourceUtils.getSingleDsJsonFromWholeServiceDefinition(d,e,t,(null==r?void 0:r.childDataSourceJsons)&&r.childDataSourceJsons[u]?r.childDataSourceJsons[u]:null)),a&&((null===(s=o.getDataSourceJson())||void 0===s?void 0:s.portalUrl)&&(a=a.set("portalUrl",o.getDataSourceJson().portalUrl)),(null===(c=o.getDataSourceJson())||void 0===c?void 0:c.itemId)&&(a=a.set("itemId",o.getDataSourceJson().itemId)),l&&(a=a.set("schema",l)),i.push(a.set("jimuChildId",u)))})),i},t}(r(135).AbstractSetDataSource);t.AbstractLayerFolderDataSource=s},248:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(60),n=r(4),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.load=function(){var e=this;return this.setStatus(n.DataSourceStatus.Loading),this.doLoad().then((function(t){return e.records=t,e.setStatus(n.DataSourceStatus.Loaded),e.records}))},t}(i.AbstractDataSource);t.AbstractLoadableDataSource=u},249:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},n=this&&this.__rest||function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(r[o[a]]=e[o[a]])}return r};Object.defineProperty(t,"__esModule",{value:!0});var u=r(23),s=r(60),c=r(4),l=r(14),d=function(e){function t(t){var r=e.call(this,t)||this;return r.count=null,r.pages={},r.pagePromises={},r.url=r.getDataSourceJson().url,r.setStatus(c.DataSourceStatus.Unloaded),r.setCountStatus(c.DataSourceStatus.Unloaded),r}return a(t,e),t.prototype.getCurrentQueryParams=function(e){var t=this.getRuntimeQueryParams(e&&e.dataSourceId===this.id?null==e?void 0:e.widgetId:null);return this.getCurrentQueryParamsByQuery(t,e)},t.prototype.getRuntimeQueryParams=function(e){var t=e?this.getInfo().widgetQueries.without(e):this.getInfo().widgetQueries;return this.getMergedWidgetQueries(t)},t.prototype.getCurrentQueryParamsByQuery=function(e,t){var r;return this.isLocal?r=this.mergeQueryParams(this.belongToDataSource.getCurrentQueryParams(t),e):this.isDataView?(r=this.mergeQueryParams(this.getConfigQueryParams(),e),r=this.mergeQueryParams(this.getMainDataSource().getCurrentQueryParams(t),r)):(r=this.mergeQueryParams(this.getConfigQueryParams(),e),r=this.mergeQueryParams(this.getRemoteQueryParams(),r)),r},t.prototype.getMergedWidgetQueries=function(e){var t,r=this,o=e&&Object.keys(e)||[];return(o=o.sort((function(e,t){return e.localeCompare(t)}))).forEach((function(o){t=r.mergeQueryParams(t,e[o])})),t},t.prototype.getCurrentQueryId=function(){return this.lastQueryId},t.prototype.getRealQueryParams=function(e,t,r){var o,a=this;if("query"===t)r&&r.scope?r.scope===c.QueryScope.InAllData?o=e:r.scope===c.QueryScope.InRemoteConfigView?o=this.mergeQueryParams(this.getRemoteQueryParams(),e):r.scope===c.QueryScope.InConfigView?(o=this.mergeQueryWithConfigQuery(e),o=this.mergeQueryParams(this.getRemoteQueryParams(),o)):o=r.scope===c.QueryScope.InRuntimeView?this.mergeQueryParams(this.getCurrentQueryParams(r.excludeQuery),e):e:o=this.mergeQueryParams(this.getCurrentQueryParams(null==r?void 0:r.excludeQuery),e);else{if(!r||!r.widgetId)return console.error("Please pass widget id for load."),null;var i=function(){var t,o=a.getInfo().widgetQueries||u.Immutable({});return(null==r?void 0:r.excludeQuery)&&(o=o.without(r.excludeQuery.widgetId)),o=o.set(r.widgetId,e),t=a.getMergedWidgetQueries(o),t=a.getCurrentQueryParamsByQuery(t,null==r?void 0:r.excludeQuery)};r&&r.scope?r.scope===c.QueryScope.InAllData?o=e:r.scope===c.QueryScope.InRemoteConfigView?o=this.mergeQueryParams(this.getRemoteQueryParams(),e):r.scope===c.QueryScope.InConfigView?(o=this.mergeQueryWithConfigQuery(e),o=this.mergeQueryParams(this.getRemoteQueryParams(),o)):o=r.scope===c.QueryScope.InRuntimeView?i():e:o=i()}return o},t.prototype.getDataViewConfig=function(){return this.isLocal?this.belongToDataSource.getDataViewConfig():this.isDataView?this.getDataSourceJson().dataViews&&this.getDataSourceJson().dataViews[this.dataViewId]:this.getDataSourceJson().query},t.prototype.mergeQueryWithConfigQuery=function(e){var t;return this.isLocal?this.belongToDataSource.isDataView?(t=this.mergeQueryParams(this.belongToDataSource.getConfigQueryParams(),e),t=this.mergeQueryParams(this.getMainDataSource().getConfigQueryParams(),t)):t=this.mergeQueryParams(this.getConfigQueryParams(),e):this.isDataView?(t=this.mergeQueryParams(this.getConfigQueryParams(),e),t=this.mergeQueryParams(this.getMainDataSource().getConfigQueryParams(),t)):t=this.mergeQueryParams(this.getConfigQueryParams(),e),t},t.prototype.updateQueryParams=function(e,t){e=this.getQueryWithoutPage(e),u.utils.isDeepEqual(e,this.getInfo().widgetQueries&&this.getInfo().widgetQueries[t])||u.getAppStore().dispatch(u.appActions.updateWidgetQuery(this.id,t,e))},t.prototype.getQueryPageSize=function(){var e;return(null===(e=this.getDataViewConfig())||void 0===e?void 0:e.pageSize)||l.DEFAULT_QUERY_PAGE_SIZE},t.prototype.getMaxRecordCount=function(){var e;return(null===(e=this.getDataViewConfig())||void 0===e?void 0:e.maximum)||null},t.prototype.getQueryWithoutPage=function(e){if(!e)return null;e.pageSize,e.page;return n(e,["pageSize","page"])},t.prototype.checkClearLocalCache=function(e,t,r){var o=this.getQueryWithoutPage(e),a=this.getRealQueryParams(o,"load",r),i=r.refresh||this.getInfo().needRefresh;return!(u.utils.isDeepEqual(a,t)&&!i)},t.prototype.getRecordsByPage=function(e,t){for(var r=i({},this.pages),o=Object.keys(r).map((function(e){return parseInt(e)})).sort((function(e,t){return t-e}))[0],a=[],n=1;n<=o;n++)a=r[n]?a.concat(r[n]):a.concat(Array(this.getQueryPageSize()).fill(null));var u=t*(e-1),s=u+t,c=this.getMaxRecordCount();return null!==c&&(u=Math.min(u,c),s=Math.min(s,c)),a.slice(u,s).filter((function(e){return!!e}))},t.prototype.getPagesData=function(){return this.pages},t.prototype.setPagesData=function(e){this.pages=e},t.prototype.clearDataNotAddVersion=function(){this.getSelectedRecords().length>0&&this.copySelectionToDataView([]),this.pages={},this.pagePromises={},this.count=null,this.countPromise=null},t.prototype.clearData=function(){this.clearDataNotAddVersion(),this.addVersion()},t.prototype.getRecords=function(){for(var e=this,t=[],r=[],o=1;o<=Object.keys(this.pages).length&&this.pages[o];o++)r.push(o);return r.forEach((function(r){t=t.concat(e.pages[r])})),null!==this.getMaxRecordCount()&&this.getMaxRecordCount()<t.length?t.slice(0,this.getMaxRecordCount()):t},t.prototype.getRealQueryPages=function(e,t){var r=t*(e-1),o=r+t-1;null!==this.getMaxRecordCount()&&(o=Math.min(o,this.getMaxRecordCount()-1));for(var a=Math.floor(r/this.getQueryPageSize())+1,i=Math.floor(o/this.getQueryPageSize())+1,n=[],u=a;u<=i;u++)n.push(u);return n},t.prototype.load=function(e,t){var r=this;void 0===t&&(t={}),(e=i({},e)).page||(e.page=1),e.pageSize||(e.pageSize=this.getQueryPageSize());var o=this.getRealQueryPages(e.page,e.pageSize);this.checkClearLocalCache(e,this.lastQueryParams,t)&&(Object.keys(this.pages).forEach((function(e){o.indexOf(parseInt(e))<0&&delete r.pages[e]})),this.pagePromises={},this.count=null,this.countPromise=null),this.updateQueryParams(e,t.widgetId);var a=this.getQueryWithoutPage(e),n=this.getRealQueryParams(a,"load",t),s=o.filter((function(e){return r.pagePromises[e]})).map((function(e){return r.pagePromises[e]}));return s.length===o.length?Promise.all(s).then((function(){return r.getRecordsByPage(e.page,e.pageSize)})):(this.lastQueryParams=n,this.setStatus(c.DataSourceStatus.Loading),u.getAppStore().dispatch(u.appActions.setDataNeedRefresh(this.id,!1)),Promise.all(o.map((function(e){return r.loadByPage(n,e)}))).then((function(t){if(!t.find((function(e){return e})))return[];var o=r.getRecords(),a=[];return r.getSelectedRecordIds().length>0?a=r.getSelectedRecordIds().map((function(e){return o.filter((function(t){return t&&t.getId()===e}))[0]})):r.getSelectedRecordIndexes().length>0&&(a=r.getSelectedRecordIndexes().map((function(e){return o[e]}))),a.length>0&&r.copySelectionToDataView(a),r.lastRefreshTime=new Date,r.setStatus(c.DataSourceStatus.Loaded),window.jimuConfig.isInBuilder&&u.getAppStore().getState().appRuntimeInfo.appMode===u.AppMode.Design||r.startAutoRefresh(),r.getRecordsByPage(e.page,e.pageSize)}),(function(e){return console.error(e),r.setStatus(c.DataSourceStatus.LoadError),[]})))},t.prototype.loadByPage=function(e,t){var r=this;if(this.pagePromises[t])return this.pagePromises[t];var o=i(i({},e),{page:t,pageSize:this.getQueryPageSize()});return this.pagePromises[t]=this.doQuery(u.Immutable(o)).then((function(e){var t=r.getQueryWithoutPage(e.queryParams);return!!u.utils.isDeepEqual(t,r.lastQueryParams)&&(r.pages[e.queryParams.page]=e.records,!0)})),this.pagePromises[t]},t.prototype.loadCount=function(e,t){var r=this;if(void 0===t&&(t={}),!this.checkClearLocalCache(e,this.lastCountQueryParams,t)&&this.countPromise)return this.countPromise;var o=this.getRealQueryParams(this.getQueryWithoutPage(e),"load",t);return this.lastCountQueryParams=o,this.setCountStatus(c.DataSourceStatus.Loading),this.countPromise=this.doQueryCount(u.Immutable(o)).then((function(e){return u.utils.isDeepEqual(e.queryParams,r.lastCountQueryParams)?(null===r.getMaxRecordCount()?r.count=e.count:r.count=Math.min(e.count,r.getMaxRecordCount()),r.setCountStatus(c.DataSourceStatus.Loaded),r.count):null}),(function(e){console.error(e),r.setCountStatus(c.DataSourceStatus.LoadError)})),this.countPromise},t.prototype.query=function(e,t){var r=this,o=this.getRealQueryParams(e,"query",t);return this.doQuery(u.Immutable(o)).then((function(e){var t=r.getMaxRecordCount();if(null===t)return e;var o=e.queryParams.page||1,a=e.queryParams.pageSize;return 1!==o&&a?(o-1)*a>t?e.records=[]:(o-1)*a+e.records.length>t&&(e.records=e.records.slice(0,(o-1)*a+e.records.length-t)):e.records.length>t&&(e.records=e.records.slice(0,t)),e}))},t.prototype.queryCount=function(e,t){var r=this,o=this.getRealQueryParams(e,"query",t);return this.doQueryCount(u.Immutable(o)).then((function(e){return null===r.getMaxRecordCount()||(e.count=Math.min(e.count,r.getMaxRecordCount())),e}))},t.prototype.loadById=function(e,t){var r=this;return e===this.lastQueryId&&!t&&this.byIdPromise||(this.lastQueryId=e,this.setStatus(c.DataSourceStatus.Loading),this.byIdPromise=this.doQueryById(e).then((function(e){return r.setStatus(c.DataSourceStatus.Loaded),e}),(function(e){return console.error(e),r.setStatus(c.DataSourceStatus.LoadError),null}))),this.byIdPromise},t.prototype.queryById=function(e){return this.doQueryById(e)},t.prototype.getAutoRefreshInterval=function(){var e=this.getMainDataSource(),t=e.getDataViewConfig()&&e.getDataViewConfig().refreshInterval;return 0===t?0:(null==t&&(t=e.getSchema().refreshInterval),t)},t.prototype.getLastRefreshTime=function(){return this.lastRefreshTime},t.prototype.startAutoRefresh=function(){var e=this,t=this.getAutoRefreshInterval();t&&(this.autoRefreshHandle||(u.getAppStore().dispatch(u.appActions.setDataNeedRefresh(this.id,!1)),this.autoRefreshHandle=setTimeout((function(){u.getAppStore().dispatch(u.appActions.setDataNeedRefresh(e.id,!0)),e.stopAutoRefresh()}),1e3*t)))},t.prototype.stopAutoRefresh=function(){this.autoRefreshHandle&&(clearTimeout(this.autoRefreshHandle),this.autoRefreshHandle=null)},t.prototype.addRecord=function(e){var t=this;return this.setSaveStatus(c.DataSourceStatus.Saving),this.doAdd(e).then((function(e){return t.records.push(e),t.setSaveStatus(c.DataSourceStatus.Saved),e}))},t.prototype.updateRecord=function(e){var t=this;return this.setSaveStatus(c.DataSourceStatus.Saving),this.doUpdateRecord(e).then((function(e){var r=t.records.findIndex((function(t){return t.getId()===e.getId()}));return t.records.splice(r,1,e),t.setSaveStatus(c.DataSourceStatus.Saved),e}))},t.prototype.deleteRecord=function(e){var t=this;return this.setSaveStatus(c.DataSourceStatus.Saving),this.doDeleteRecord(e).then((function(){t.records.splice(e,1),t.setSaveStatus(c.DataSourceStatus.Saved)}))},t.prototype.getSaveStatus=function(){var e;return null===(e=u.getAppStore().getState().dataSourcesInfo[this.id])||void 0===e?void 0:e.saveStatus},t.prototype.setSaveStatus=function(e){u.getAppStore().dispatch(u.appActions.dataSourceSaveStatusChanged(this.id,e))},t.prototype.getMainDataSource=function(){return e.prototype.getMainDataSource.call(this)},t.prototype.getDataViews=function(){return e.prototype.getDataViews.call(this)},t.prototype.getDataView=function(t){return e.prototype.getDataView.call(this,t)},t}(s.AbstractDataSource);t.AbstractQueriableDataSource=d},250:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(23),n=function(){function e(){}return e.prototype.getFieldValue=function(e){return this.getData()[e]},e.prototype.getFormattedFieldValue=function(e,t){var r=this.dataSource.getSchema().fields[e];if(!r)return this.getFieldValue(e);if(r.format)switch(r.type){case i.JimuFieldType.Date:return this.formatDateField(this.getFieldValue(e),r.format.dateFormat,t);case i.JimuFieldType.Number:return this.formatNumberField(this.getFieldValue(e),r.format.places,r.format.digitSeparator,t);default:return this.getFieldValue(e)}else switch(r.type){case i.JimuFieldType.Date:return null!==this.getFieldValue(e)&&void 0!==this.getFieldValue(e)?t.formatDate(this.getFieldValue(e)):null;case i.JimuFieldType.Number:return null!==this.getFieldValue(e)&&void 0!==this.getFieldValue(e)?t.formatNumber(this.getFieldValue(e)):null;default:return this.getFieldValue(e)}},e.prototype.convertBeforeMappingDataToData=function(e){var t={},r=this.dataSource.getReversedConfigSchema();return Object.keys(e).forEach((function(o){var a=r&&r.fields&&r.fields[o];a?a.forEach((function(r){t[r.jimuName]=e[o]})):t[o]=e[o]})),t},e.prototype.convertDataToDataBeforeMapping=function(e){var t={},r=this.dataSource.getSchema();return Object.keys(e).forEach((function(o){var a=r&&r.fields&&r.fields[o]?r.fields[o].name:o;t[a]=e[o]})),t},e.prototype.getFormattedData=function(e){var t=this,r={};return Object.keys(this.getData()).forEach((function(o){r[o]=t.getFormattedFieldValue(o,e)})),r},e.prototype.formatDateField=function(e,t,r){if(!e)return null;"number"==typeof e&&(e=new Date(e));var o=i.dateUtils.ESRI_DATE_FORMAT_MAP[t];if(!o)return console.warn("Invalid data format "+t),null;var a=i.dateUtils.formatDate(e,o.datePattern,r);if("date and time"===o.selector){var n=i.dateUtils.formatTime(e,o.timePattern,r),u=r.locale||"en";a=a+(i.dateUtils.DATE_TIME_CONNECTOR[u]||i.dateUtils.DATE_TIME_CONNECTOR.common)+n}return a},e.prototype.formatNumberField=function(e,t,r,o){if(null===e||void 0===typeof e)return null;var a=new Number(e);return r?o.formatNumber(e,{maximumFractionDigits:t,minimumFractionDigits:t}):a.toFixed(t)},e}();t.AbstractDataRecord=n;var u=function(e){function t(t,r,o){void 0===o&&(o=!0);var a=e.call(this)||this;return a.dataSource=r,a.data=o?a.convertBeforeMappingDataToData(t):t,a}return a(t,e),t.prototype.getData=function(){return this.data},t.prototype.getDataBeforeMapping=function(){return this.convertDataToDataBeforeMapping(this.data)},t.prototype.toJson=function(){return this.data},t.prototype.getId=function(){return this.data.id},t.prototype.setId=function(){},t.prototype.getGeometry=function(){return null},t}(n);t.SimpleDataRecordImpl=u;var s=function(e){Object.assign(this,e)};t.SimpleDataRecordSetImpl=s},251:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),n=r(24),u=function(e){function t(t){var r=e.call(this,t)||this;return r.type=i.DataSourceTypes.CSV,t.dataSourceJson.data?(r.records=t.dataSourceJson.data.asMutable().map((function(e){return new n.SimpleDataRecordImpl(e,r)})),r.setStatus(i.DataSourceStatus.Loaded)):r.url=t.dataSourceJson.url,r}return a(t,e),t.prototype.doLoad=function(){var e=this;return fetch(this.url).then((function(e){return e.json()})).then((function(t){return t.map((function(t){return new n.SimpleDataRecordImpl(t,e)}))}))},t}(n.AbstractLoadableDataSource);t.CsvDataSourceImpl=u},252:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=r(23),u=r(82),s=r(24),c=r(4),l=function(e){function t(t){var r=e.call(this,t)||this;r.type=c.DataSourceTypes.FeatureLayer;var o=r.getDataSourceJson();return r.portalUrl=o.portalUrl,r.itemId=o.itemId,r.layerId=o.layerId,t.layer&&(r.layer=t.layer),t.belongToDataSource&&t.belongToDataSource.layer&&(r.layer=t.belongToDataSource.layer),r}return a(t,e),t.prototype.getIdField=function(){var e=this.getLayerDefinition(),t=e.objectIdField;if(!t){var r=e.fields.find((function(e){return"esriFieldTypeOID"===e.type}));r&&(t=r.name)}return t||(t="OBJECTID"),t},t.prototype.getGeometryType=function(){return this.getLayerDefinition().geometryType},t.prototype.setJsonData=function(e){var t=this;this.records=e.map((function(e){return new u.FeatureDataRecordImpl(e,t,!1)}))},t.prototype.doQuery=function(e){return this.layer?this._doQueryByLayer(e):this._doQueryByUrl(e)},t.prototype.doQueryCount=function(e){var t=this._changeQueryPropertiesFormat(e);return delete t.resultRecordCount,delete t.resultOffset,t.returnCountOnly||(t.returnCountOnly=!0),this._q(t).then((function(t){return{queryParams:e,count:t.count}}))},t.prototype.doQueryById=function(e){return this.doQuery(n.Immutable({objectIds:[parseInt(e)],returnGeometry:!0})).then((function(e){return e.records[0]}))},t.prototype.queryById=function(t){return e.prototype.queryById.call(this,t)},t.prototype.getConfigQueryParams=function(){var e=this.getDataViewConfig();return e?{where:n.dataSourceUtils.getArcGISSQL(e.where,this).sql,orderByFields:this._getOrderByArray(e.orderBy)}:null},t.prototype.mergeQueryParams=function(e,t){var r;return r=[e&&e.where,t&&t.where].filter((function(e){return e})).join(" and "),i(i(i({},e),t),{where:r})},t.prototype.getCurrentQueryParams=function(t){var r=e.prototype.getCurrentQueryParams.call(this,t);return this.applyGDBVersionAndFix(r)},t.prototype.getRealQueryParams=function(t,r,o){var a=e.prototype.getRealQueryParams.call(this,t,r,o);return this.applyGDBVersionAndFix(a)},t.prototype.getRemoteQueryParams=function(){return this.getSchema().filter?{where:this.getSchema().filter}:null},t.prototype.applyGDBVersionAndFix=function(e){return this.getGDBVersion()&&(e.gdbVersion=this.getGDBVersion()),e=this.fixQueryParam(n.Immutable(e)).asMutable({deep:!0})},t.prototype.fixQueryParam=function(e){var t=e;return e.outStatistics&&Object.keys(e).forEach((function(e){["groupByFieldsForStatistics","time","where","outStatistics","geometry"].indexOf(e)<0&&(t=t.without(e))})),t},t.prototype.addRecord=function(e){var t=this,r=e.getData(),o={attributes:r},a={url:this.url,features:[o]};return n.requestUtils.requestWrapper(this.url,(function(e){return a.authentication=e,n.esri.restFeatureLayer.addFeatures(a).then((function(e){var o=e.addResults[0].objectId;return r.OBJECTID=o,new u.FeatureDataRecordImpl({attributes:r},t)}))}))},t.prototype.fetchSchema=function(){return this.getDataSourceJson().isStatistic?Promise.resolve(n.Immutable({})):this.layer?this.fetchSchemaWithLayer():this.fetchSchemaWithoutLayer()},t.prototype.fetchSchemaWithoutLayer=function(){var e=this;return n.ServiceManager.getInstance().fetchServiceInfo(this.url).then((function(t){return e.itemId?n.requestUtils.requestWrapper(e.getDataSourceJson().portalUrl,(function(r){return n.esri.restPortal.getItemData(e.itemId,{portal:n.portalUrlUtils.getPortalRestUrl(e.portalUrl),authentication:r}).then((function(r){var o=r&&r.layers&&r.layers[e.layerId];return{serviceDefinition:e._getUpdatedLayerDefinition(o,t.definition),fieldInfos:o&&o.popupInfo&&o.popupInfo.fieldInfos,filter:o&&o.layerDefinition&&o.layerDefinition.definitionExpression,refreshInterval:60*(null==o?void 0:o.refreshInterval)}}))})):{serviceDefinition:t.definition,fieldInfos:null,filter:null,refreshInterval:null}})).then((function(t){var r,o=t.serviceDefinition,a=t.fieldInfos,i=t.filter,u=t.refreshInterval,s={fields:{},idField:o.idField,filter:i,refreshInterval:u,label:(null===(r=e.layer)||void 0===r?void 0:r.title)||o.name};return e.layerDefinition=o,o.fields.forEach((function(e){var t=a&&a.find((function(t){return t.fieldName===e.name}));s.fields[e.name]=n.dataSourceUtils.convertFieldToJimuField(e,t)})),n.Immutable(s)}))},t.prototype.fetchSchemaWithLayer=function(){var e=this;return this.layer.load().then((function(){e.updateLayerDefinitionByLayer();var t={fields:{},idField:e.layer.objectIdField,filter:e.layer.definitionExpression,refreshInterval:60*e.layer.refreshInterval,label:e.layer.title};return e.layer.fields.forEach((function(r){var o=e.layer.popupTemplate&&e.layer.popupTemplate.fieldInfos&&e.layer.popupTemplate.fieldInfos.find((function(e){return e.fieldName===r.name}));o&&(o=o.toJSON()),t.fields[r.name]=n.dataSourceUtils.convertFieldToJimuField(r.toJSON(),o)})),n.Immutable(t)}))},t.prototype.updateLayerDefinitionByLayer=function(){var e=this.layer.sourceJSON,t=this.layer.renderer;if(t&&t.toJSON()){var r=t.toJSON();if("uniqueValue"===r.type){var o=this.layer.sourceJSON.types;r.field1!==this.layer.sourceJSON.typeIdField&&(o=[],r.uniqueValueInfos.map((function(e){o.push({id:e.value,name:e.label,domain:{}})}))),e=Object.assign({},e,{drawingInfo:{renderer:r},typeIdField:r.field1,types:o})}}this.layerDefinition=e},t.prototype.getLayerDefinition=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getLayerDefinition():this.layerDefinition},t.prototype.getFieldCodedValueList=function(e,t){var r="",o=this.getSchema().fields;return Object.keys(o).some((function(t){return t===e&&(r=o[t].name,!0)})),n.dataSourceUtils.getCodedValueListForCodedValueOrSubtypeField(this.getLayerDefinition(),r,t)},t.prototype.getGDBVersion=function(){return this.getInfo().gdbVersion},t.prototype.changeGDBVersion=function(e){n.getAppStore().dispatch(n.appActions.changeDataSourceGDBVersion(this.id,e)),this.layer&&(this.layer.gdbVersion=e)},t.prototype.getRootLayerDataSource=function(){for(var e,t=this.parentDataSource,r=null===(e=this.parentDataSource)||void 0===e?void 0:e.parentDataSource;this._isLayerDataSource(t)&&this._isLayerDataSource(r);)t=r,r=r.parentDataSource;return t},t.prototype.getOriginalDataId=function(){var e,t;return(null===(e=this.layer)||void 0===e?void 0:e.id)||(null===(t=this.layerDefinition)||void 0===t?void 0:t.id)},t.prototype._isLayerDataSource=function(e){var t,r,o;return(null===(t=e)||void 0===t?void 0:t.layer)||(null===(r=e)||void 0===r?void 0:r.layerDefinition)||(null===(o=e)||void 0===o?void 0:o.serviceDefinition)},t.prototype._getUpdatedLayerDefinition=function(e,t){var r=t;if(e&&e.layerDefinition){var o=void 0,a=e.layerDefinition.drawingInfo;if(a){if(a.renderer&&"uniqueValue"===a.renderer.type){var i=t.types;a.renderer.field1!==t.typeIdField&&(i=[],a.renderer.uniqueValueInfos.map((function(e){i.push({id:e.value,name:e.label,domain:{}})}))),o={defaultVisibility:e.layerDefinition.defaultVisibility,drawingInfo:e.layerDefinition.drawingInfo,typeIdField:a.renderer.field1,types:i}}}else e.layerDefinition.defaultVisibility!==t.defaultVisibility&&(o={defaultVisibility:e.layerDefinition.defaultVisibility});r=Object.assign({},r,o)}return r},t.prototype._getOrderByArray=function(e){var t;return null!==(t=null==e?void 0:e.map((function(e){return e.jimuFieldName+" "+e.order})).asMutable())&&void 0!==t?t:[]},t.prototype._changeQueryPropertiesFormat=function(e){if(!e)return null;var t=this.fixQueryParam(e).asMutable({deep:!0});return t.page&&t.pageSize&&(t.resultOffset=(t.page-1)*t.pageSize,t.resultRecordCount=t.pageSize,delete t.page,delete t.pageSize),Array.isArray(t.orderByFields)&&(t.orderByFields=t.orderByFields.join(",")),Array.isArray(t.groupByFieldsForStatistics)&&(t.groupByFieldsForStatistics=t.groupByFieldsForStatistics.join(",")),t},t.prototype._doQueryByUrl=function(e){var t=this,r=this._changeQueryPropertiesFormat(e);if(r.returnCountOnly)return console.error("To query count, please use queryCount."),Promise.reject("To query count, please use queryCount.");if(r.outFields&&"*"!==r.outFields&&"*"!==r.outFields[0]){var o=this.getLayerDefinition().typeIdField;o&&r.outFields.indexOf(o)<0&&r.outFields.push(o)}return this._q(r).then((function(r){var o=Object.keys(t.getSchema().fields).filter((function(e){return r.fields&&r.fields.find((function(r){return r.name===t.getSchema().fields[e].name}))}));return{queryParams:e,fields:o,records:r.features.map((function(e){return new u.FeatureDataRecordImpl(e,t)}))}}))},t.prototype._doQueryByLayer=function(e){var t=this,r=this.fixQueryParam(e),o=r.asMutable({deep:!0});return n.loadArcGISJSAPIModules(["esri/geometry/support/jsonUtils"]).then((function(a){var i=a[0];if(r.page&&r.pageSize&&(o.start=(r.page-1)*r.pageSize,o.num=r.pageSize,delete o.page,delete o.pageSize),o.geometry=i.fromJSON(o.geometry),delete o.key,t.getGDBVersion()&&(o.gdbVersion=t.getGDBVersion()),o.outFields=o.outFields&&o.outFields.length>0?o.outFields:["*"],o.outFields&&"*"!==o.outFields[0]){var n=t.getLayerDefinition().typeIdField;n&&o.outFields.indexOf(n)<0&&o.outFields.push(n)}return t.layer.queryFeatures(o).then((function(r){var o=r.features.map((function(e){return new u.FeatureDataRecordImpl(e,t)})),a=Object.keys(t.getSchema().fields).filter((function(e){return r.fields&&r.fields.find((function(r){return r.name===t.getSchema().fields[e].name}))}));return{queryParams:e,records:o,fields:a}}))}))},t.prototype._q=function(e){var t=i({url:this.url},e);return n.requestUtils.requestWrapper(this.url,(function(e){return t.authentication=e,n.esri.restFeatureLayer.queryFeatures(t)}))},t}(s.AbstractQueriableDataSource);t.FeatureLayerDataSourceImpl=l},253:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=i.DataSourceTypes.FeatureService,t}return a(t,e),t}(r(24).AbstractLayerFolderDataSource);t.FeatureServiceDataSourceImpl=n},254:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(24),n=r(4),u=r(82),s=function(e){function t(t){var r=e.call(this,t)||this;return r.type=n.DataSourceTypes.FeatureSet,r.records=t.records||[],r}return a(t,e),t.prototype.getIdField=function(){return this.getDataSourceJson().schema&&this.getDataSourceJson().schema.idField?this.getDataSourceJson().schema.idField:this.getDataSourceJson().originDataSources&&this.getDataSourceJson().originDataSources.length>0&&this.dataSourceManager.getDataSource(this.getDataSourceJson().originDataSources[0].dataSourceId)?this.dataSourceManager.getDataSource(this.getDataSourceJson().originDataSources[0].dataSourceId).getIdField():e.prototype.getIdField.call(this)},t.prototype.setJsonData=function(e){var t=this;this.records=e.map((function(e){return new u.FeatureDataRecordImpl(e,t,!1)}))},t.prototype.addRecord=function(e){},t}(i.AbstractDataSource);t.FeatureSetDataSourceImpl=s},255:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(24),n=r(4),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=n.DataSourceTypes.GroupLayer,t}return a(t,e),t}(i.AbstractLayerFolderDataSource);t.GroupLayerDataSourceImpl=u},256:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(24),n=r(4),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=n.DataSourceTypes.MapService,t}return a(t,e),t}(i.AbstractLayerFolderDataSource);t.MapServiceDataSourceImpl=u},257:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(23),n=r(24),u=r(4),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=u.DataSourceTypes.SimpleLocal,t}return a(t,e),t.prototype.updateAllRecoreds=function(e){this.records=e,this.addVersion()},t.prototype.addRecord=function(e){return e.getId()||e.setId(i.uuidv1()),this.records.push(e),this.addVersion(),e},t.prototype.updateRecord=function(e){var t=this.records.findIndex((function(t){return t.getId()===e.getId()}));this.records.splice(t,1,e),this.addVersion()},t.prototype.deleteRecord=function(e){this.records.splice(e,1),this.addVersion()},t}(n.AbstractDataSource);t.SimpleLocalDataSourceImpl=s},4:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NotCreated="NOT_CREATED",e.Created="CREATED",e.CreateError="CREATE_ERROR",e.Unloaded="UNLOADED",e.Loading="LOADING",e.Loaded="LOADED",e.LoadError="LOAD_ERROR",e.Saving="SAVING",e.Saved="SAVED",e.SaveError="SAVE_ERROR",e.Closed="CLOSED",e.Connecting="CONNECTING",e.Connected="CONNECTED",e.Closing="CLOSING"}(t.DataSourceStatus||(t.DataSourceStatus={})),function(e){e.SimpleLocal="SIMPLE_LOCAL",e.CSV="CSV",e.FeatureLayer="FEATURE_LAYER",e.FeatureQuery="FEATURE_LAYER",e.FeatureSet="FEATURE_SET",e.GroupLayer="GROUP_LAYER",e.FeatureService="FEATURE_SERVICE",e.MapService="MAP_SERVICE"}(t.DataSourceTypes||(t.DataSourceTypes={})),function(e){e.FeatureLayer="Feature Layer",e.Table="Table",e.GroupLayer="Group Layer"}(t.SupportedLayerServiceTypes||(t.SupportedLayerServiceTypes={})),function(e){e.FeatureService="FeatureServer",e.MapService="MapServer"}(t.SupportedServiceTypes||(t.SupportedServiceTypes={})),function(e){e.FeatureLayer="feature",e.MapImageLayer="map-image",e.TileLayer="tile",e.GroupLayer="group"}(t.SupportedLayerTypes||(t.SupportedLayerTypes={})),function(e){e.InAllData="IN_ALL_DATA",e.InRemoteConfigView="IN_REMOTE_CONFIG_VIEW",e.InConfigView="IN_CONFIG_VIEW",e.InRuntimeView="IN_RUNTIME_VIEW"}(t.QueryScope||(t.QueryScope={}));var i=function(e){function t(t,r){var o=e.call(this,r)||this;return o.dataSourceId=t,o}return a(t,e),t}(Error);t.DataSourceError=i},5:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(t.BrowserSizeMode||(t.BrowserSizeMode={})),function(e){e.String="STRING",e.Number="NUMBER",e.Date="DATE"}(t.JimuFieldType||(t.JimuFieldType={})),function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(t.EsriFieldType||(t.EsriFieldType={})),function(e){e.Fetching="FETCHING",e.Success="SUCCESS",e.Error="ERROR"}(t.AjaxState||(t.AjaxState={})),function(e){e.Design="DESIGN",e.Run="RUN"}(t.AppMode||(t.AppMode={})),function(e){e.Opened="OPENED",e.Active="ACTIVE",e.Closed="CLOSED"}(t.WidgetState||(t.WidgetState={})),function(e){e.None="NONE",e.Page="PAGE",e.Dialog="DIALOG",e.View="VIEW",e.WebAddress="WEB_ADDRESS"}(t.LinkType||(t.LinkType={})),function(e){e.Normal="NORMAL",e.Layout="LAYOUT"}(t.WidgetType||(t.WidgetType={})),t.ESRI_DATE_FORMAT_ARRAY=["shortDate","shortDateLE","longMonthDayYear","dayShortMonthYear","longDate","shortDateShortTime","shortDateLEShortTime","shortDateShortTime24","shortDateLEShortTime24","shortDateLongTime","shortDateLELongTime","shortDateLongTime24","shortDateLELongTime24","longMonthYear","shortMonthYear","year"],function(e){e.Header="HEADER",e.Footer="FOOTER",e.Body="BODY"}(t.PagePart||(t.PagePart={})),function(e){e.Http="http:",e.Https="https:"}(t.UrlProtocol||(t.UrlProtocol={})),t.APP_FRAME_NAME_IN_BUILDER="_appWindow",function(e){e.Image="IMAGE",e.Config="CONFIG"}(t.ResourceType||(t.ResourceType={}))},60:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(23),a=r(14),i=function(){function e(e){if(this.isDataSourceSet=!1,this.records=[],Object.assign(this,e),e.dataSourceJson)this.isDataView=!1,this.isLocal=!1;else{if(!e.belongToDataSource)return void console.error("bad DataSourceConstructorOptions.");e.localId?(this.isLocal=!0,this.isDataView=!1):(this.isLocal=!1,this.isDataView=!0)}}return e.prototype.getLabel=function(){var e=this.getDataSourceJson().label||this.getSchema().label;if(this.isLocal)return this.belongToDataSource.getLabel();if(this.isDataView){var t=this.getMainDataSource().getDataSourceJson(),r=(null==t?void 0:t.dataViews)&&t.dataViews[this.dataViewId];return(null==r?void 0:r.label)||e}return e},e.prototype.getDataSourceJson=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getDataSourceJson():this.dataSourceJson},e.prototype.setDataSourceJson=function(e){e&&(this.dataSourceJson?this.dataSourceJson=this.dataSourceJson.merge(e.asMutable({deep:!0})):this.dataSourceJson=e)},e.prototype.getSchema=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getSchema():this.schema||{}},e.prototype.getSelectedFields=function(){var e,t,r,o;if(this.isLocal)return this.belongToDataSource.getSelectedFields();if(!(o=this.isDataView?null===(t=this.getDataSourceJson().dataViews[this.dataViewId])||void 0===t?void 0:t.outFields:null===(r=this.getDataSourceJson().query)||void 0===r?void 0:r.outFields))return this.getSchema().fields;var a=Object.keys(this.getSchema().fields).filter((function(e){return o.indexOf(e)<0}));return(e=this.getSchema().fields).without.apply(e,a)},e.prototype.setSchema=function(e){this.schema=e},e.prototype.fetchSchema=function(){return Promise.resolve(o.Immutable({}))},e.prototype.getFetchedSchema=function(){return this.isDataView||this.isLocal?this.getMainDataSource().getFetchedSchema():this.fetchedSchema},e.prototype.setFetchedSchema=function(e){this.fetchedSchema=e},e.prototype.getGeometryType=function(){return null},e.prototype.getReversedConfigSchema=function(){var e=this;if(this.isDataView||this.isLocal)return this.getMainDataSource().getReversedConfigSchema();if(this.reverseSchema)return this.reverseSchema;if(this.isDataSourceSet){var t=this.getDataSourceJson().schema,r={childSchemas:{}};if(!t)return o.Immutable({});if(!t.childSchemas)return o.Immutable({label:t.label,childId:t.childId,jimuChildId:t.jimuChildId});Object.keys(t.childSchemas).forEach((function(o){var a=t.childSchemas[o].childId;r.childSchemas[a]?r.childSchemas[a].push(e.getOneReversedConfigSchema(t.childSchemas[o])):r.childSchemas[a]=[e.getOneReversedConfigSchema(t.childSchemas[o])]})),this.reverseSchema=o.Immutable(r)}else this.reverseSchema=this.getOneReversedConfigSchema(this.getDataSourceJson().schema);return this.reverseSchema},e.prototype.setRecords=function(e){this.records=e,this.addVersion()},e.prototype.setJsonData=function(e){console.error("please implement this. setJsonData")},e.prototype.getOneReversedConfigSchema=function(e){var t={};return e?(t.fields={},Object.keys(e.fields).forEach((function(r){var o=e.fields[r].asMutable({deep:!0});t.fields[o.name]?t.fields[o.name].push(o):t.fields[o.name]=[o]})),e.childId&&(t.childId=e.childId),e.jimuChildId&&(t.jimuChildId=e.jimuChildId),o.Immutable(t)):o.Immutable(t)},e.prototype.getStatus=function(){return o.getAppStore().getState().dataSourcesInfo[this.id]&&o.getAppStore().getState().dataSourcesInfo[this.id].status},e.prototype.setStatus=function(e){o.getAppStore().dispatch(o.appActions.dataSourceStatusChanged(this.id,e))},e.prototype.getCountStatus=function(){return o.getAppStore().getState().dataSourcesInfo[this.id]&&o.getAppStore().getState().dataSourcesInfo[this.id].countStatus},e.prototype.setCountStatus=function(e){o.getAppStore().dispatch(o.appActions.dataSourceCountStatusChanged(this.id,e))},e.prototype.getVersion=function(){var e;return null===(e=o.getAppStore().getState().dataSourcesInfo[this.id])||void 0===e?void 0:e.version},e.prototype.addVersion=function(){o.getAppStore().dispatch(o.appActions.dataSourceVersionAdded(this.id))},e.prototype.getRecords=function(){return this.records},e.prototype.getSelectionDataView=function(){var e=this.isDataView||this.isLocal?this.getMainDataSource().id:this.id;return this.dataSourceManager.getDataViewDataSource(e,a.SELECTION_DATA_VIEW_ID)},e.prototype.getSelectedRecords=function(){var e=this.getSelectionDataView();return e?e.getRecords():[]},e.prototype.getSelectedRecordIndexes=function(){var e=this;if(!o.getAppStore().getState().dataSourcesInfo[this.id])return[];var t=this.isDataView||this.isLocal?this.getMainDataSource().id:this.id;return o.getAppStore().getState().dataSourcesInfo[t].selectedIndexes?o.getAppStore().getState().dataSourcesInfo[t].selectedIndexes.asMutable():o.getAppStore().getState().dataSourcesInfo[t].selectedIds?o.getAppStore().getState().dataSourcesInfo[t].selectedIds.asMutable().map((function(t){return e.getRecords().findIndex((function(e){return e.getId()==t}))})):[]},e.prototype.getSelectedRecordIds=function(){var e=this,t=this.isDataView||this.isLocal?this.getMainDataSource().id:this.id;return o.getAppStore().getState().dataSourcesInfo[t]?o.getAppStore().getState().dataSourcesInfo[t].selectedIds?o.getAppStore().getState().dataSourcesInfo[t].selectedIds.asMutable():o.getAppStore().getState().dataSourcesInfo[t].selectedIndexes?o.getAppStore().getState().dataSourcesInfo[t].selectedIndexes.asMutable().map((function(t){return e.getRecords()[t].getId()})):[]:[]},e.prototype.nextRecord=function(){if(this.getSelectedRecordIndexes().length>1)return console.warn('method "nextRecord" only works when single record is selected'),null;if(this.getSelectedRecordIndexes().indexOf(this.getRecords().length-1))throw Error("Reach the end of data.");return o.getAppStore().dispatch(o.appActions.dataSourceSelectedIndexesChanged(this.id,[this.getSelectedRecordIndexes()[0]++])),this.getSelectedRecords()[0]},e.prototype.prevRecord=function(){if(this.getSelectedRecordIndexes().length>1)return console.warn('method "prevRecord" only works when single record is selected'),null;if(this.getSelectedRecordIndexes().indexOf(0))throw Error("Reach the start of data.");return o.getAppStore().dispatch(o.appActions.dataSourceSelectedIndexesChanged(this.id,[this.getSelectedRecordIndexes()[0]--])),this.getSelectedRecords()[0]},e.prototype.getRecord=function(e){return this.getRecords()[e]},e.prototype.getRecordById=function(e){return this.getRecords().filter((function(t){return t&&t.getId()===e}))[0]},e.prototype.clearSelection=function(){var e=this;this.clearOneDsSelection(this.getMainDataSource()),this.getMainDataSource().getAllDerivedDataSources().forEach((function(t){return e.clearOneDsSelection(t)}))},e.prototype.clearOneDsSelection=function(e){o.getAppStore().dispatch(o.appActions.dataSourceSelectedIndexesChanged(e.id,null)),o.getAppStore().dispatch(o.appActions.dataSourceSelectedIdsChanged(e.id,null)),e===this.getMainDataSource()&&(o.jimuHistory.changeQueryObjectByDataRecordIds(e.id,null),o.jimuHistory.changeQueryObjectByDataRecordIndexes(e.id,null),this.copySelectionToDataView([]))},e.prototype.updateSelectionStateAndChangeUrl=function(e,t){var r=this,i=this.getMainDataSource();if("byIndex"===e)if(o.getAppStore().dispatch(o.appActions.dataSourceSelectedIndexesChanged(this.id,t)),i.getAllDerivedDataSources().forEach((function(e){if(e.id!==r.dataSourceManager.getDataViewDataSourceId(i.id,a.SELECTION_DATA_VIEW_ID)&&e.id!==r.dataSourceManager.getDataViewDataSourceId(i.id,a.DATA_VIEW_ID_FOR_NO_SELECTION)&&e.id!==r.id){var n=t.map((function(e){return r.getRecord(e)&&r.getRecord(e).getId()}));o.getAppStore().dispatch(o.appActions.dataSourceSelectedIdsChanged(e.id,n))}})),this===i)o.jimuHistory.changeQueryObjectByDataRecordIndexes(this.id,t);else{var n=t.map((function(e){return r.getRecord(e)&&r.getRecord(e).getId()}));o.getAppStore().dispatch(o.appActions.dataSourceSelectedIdsChanged(i.id,n)),o.jimuHistory.changeQueryObjectByDataRecordIds(i.id,n)}else"byId"===e&&(i.getAllDerivedDataSources().forEach((function(e){e.id!==r.dataSourceManager.getDataViewDataSourceId(i.id,a.SELECTION_DATA_VIEW_ID)&&e.id!==r.dataSourceManager.getDataViewDataSourceId(i.id,a.DATA_VIEW_ID_FOR_NO_SELECTION)&&o.getAppStore().dispatch(o.appActions.dataSourceSelectedIdsChanged(e.id,t))})),o.getAppStore().dispatch(o.appActions.dataSourceSelectedIdsChanged(i.id,t)),o.jimuHistory.changeQueryObjectByDataRecordIds(i.id,t))},e.prototype.selectRecord=function(e){this.copySelectionToDataView([this.getRecord(e)]),this.updateSelectionStateAndChangeUrl("byIndex",[e])},e.prototype.selectRecords=function(e){var t=this;this.copySelectionToDataView(e.map((function(e){return t.getRecord(e)}))),this.updateSelectionStateAndChangeUrl("byIndex",e)},e.prototype.selectRecordById=function(e,t){if(!this.getSelectedRecordIds().find((function(t){return t===e}))){var r=t||e&&this.getRecordById(e);this.copySelectionToDataView([r]),this.updateSelectionStateAndChangeUrl("byId",[e])}},e.prototype.selectRecordsByIds=function(e,t){var r=this,o=t||e.map((function(e){return r.getRecordById(e)}));this.copySelectionToDataView(o),this.updateSelectionStateAndChangeUrl("byId",e)},e.prototype.copySelectionToDataView=function(e){var t=this.getSelectionDataView();t&&t.setRecords(e.filter((function(e){return!!e})))},e.prototype.getInfo=function(){return o.getAppStore().getState().dataSourcesInfo[this.id]||{}},e.prototype.clearData=function(){this.selectRecords([]),this.records=[],this.addVersion()},e.prototype.getIdField=function(){return this.getSchema()&&this.getSchema().idField||"id"},e.prototype.getRootDataSource=function(){if(this.isDataView||this.isLocal)return this.getMainDataSource().getRootDataSource();for(var e=this.parentDataSource;e&&e.parentDataSource;)e=e.parentDataSource;return e},e.prototype.ready=function(){return Promise.resolve({})},e.prototype.getOriginDataSources=function(){var e=this;return this.isDataView||this.isLocal?this.getMainDataSource().getOriginDataSources():this.getDataSourceJson().originDataSources&&0!==this.getDataSourceJson().originDataSources.length?this.getDataSourceJson().originDataSources.asMutable().map((function(t){return e.dataSourceManager.getDataSource(t.dataSourceId)})):[]},e.prototype.getMainDataSource=function(){var e;return this.belongToDataSource?null!==(e=this.belongToDataSource.belongToDataSource)&&void 0!==e?e:this.belongToDataSource:this},e.prototype.getDataViews=function(){var e=this;return this.getMainDataSource()!==this?[]:this.dataSourceManager.getDataSourcesAsArray().filter((function(t){return t.belongToDataSource===e&&t.isDataView}))},e.prototype.getDataView=function(e){return this.getDataViews().find((function(t){return t.dataViewId===e}))},e.prototype.getLocalDataSources=function(){var e=this;return this.isLocal?[]:this.dataSourceManager.getDataSourcesAsArray().filter((function(t){return t.belongToDataSource===e&&t.isLocal}))},e.prototype.getLocalDataSource=function(e){return this.getLocalDataSources().find((function(t){return t.localId===e}))},e.prototype.getAllDerivedDataSources=function(){var e=[],t=this.getDataViews(),r=this.getLocalDataSources();return e=t.concat(r),t.forEach((function(t){e=e.concat(t.getLocalDataSources())})),e},e.prototype.destroy=function(){},e}();t.AbstractDataSource=i},82:function(e,t,r){"use strict";var o,a=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var i=r(23),n=r(24),u=r(4),s=function(e){function t(t,r,o){void 0===o&&(o=!0);var a=e.call(this)||this;return a.dataSource=r,o?(t.attributes=a.convertBeforeMappingDataToData(t.attributes),a.feature=t):a.feature=t,a.fillGeometry(),a}return a(t,e),t.prototype.fillGeometry=function(){var e;if(this.feature.geometry&&this.dataSource.type!==u.DataSourceTypes.FeatureSet){var t=this.dataSource;this.feature.geometry.spatialReference||(this.feature.geometry.spatialReference=null===(e=t.getLayerDefinition().extent)||void 0===e?void 0:e.spatialReference)}},t.prototype.queryAttachments=function(e){var t,r=this,o=this.dataSource;if(!(t=o&&o.url))return Promise.resolve([]);var a={attachmentTypes:e,url:t,featureId:this.getId()};return this._queryAllAttachmentsPromise||(this._queryAllAttachmentsPromise=i.dataSourceUtils.queryAllAttachments(a)),this._queryAllAttachmentsPromise.then((function(e){return r.attachmentInfos=e,i.dataSourceUtils.filterAttachments(e,a)}))},t.prototype.getSymbolPreviewHTML=function(){var e=this;return this._isGraphicFeature()?(this._getSymbolPreviewHTMLPromise||(this._getSymbolPreviewHTMLPromise=i.loadArcGISJSAPIModules(["esri/symbols/support/symbolUtils"]).then((function(t){var r=null;return(r=t[0]).getDisplayedSymbol(e.feature).then((function(e){var t=document.createElement("div");return t.className="w-100 h-100 d-flex justify-content-center align-items-center",r.renderPreviewHTML(e,{node:t})}))}))),this._getSymbolPreviewHTMLPromise):Promise.resolve(null)},t.prototype.getData=function(){return this.feature.attributes},t.prototype.getFormattedFieldValue=function(t,r){var o=this.dataSource;if(!o.getLayerDefinition)return null;var a=o.getLayerDefinition(),n=i.dataSourceUtils.getDisplayValueForCodedValueOrSubtype(a,t,this.getData());return n.isCodedValueOrSubtype?n.displayValue:e.prototype.getFormattedFieldValue.call(this,t,r)},t.prototype.getDataBeforeMapping=function(){return this.convertDataToDataBeforeMapping(this.getData())},t.prototype.getOriginData=function(){var e=Object.assign({},this.feature);return e.attributes=this.convertDataToDataBeforeMapping(this.getData()),e},t.prototype.toJson=function(){return this.feature},t.prototype.getId=function(){return this.feature.attributes[this.dataSource.getIdField()]+""},t.prototype.setId=function(e){},t.prototype.getGeometry=function(){return this.feature.geometry},t.prototype._isGraphicFeature=function(){var e;return!!(null===(e=null==this?void 0:this.feature)||void 0===e?void 0:e.layer)},t}(n.AbstractDataRecord);t.FeatureDataRecordImpl=s}})}));