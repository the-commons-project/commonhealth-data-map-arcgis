define(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/expression-builder"],(function(e,t,r,n,s,o){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=361)}({0:function(t,r){t.exports=e},1:function(e,r){e.exports=t},25:function(e,t){e.exports=o},3:function(e,t){e.exports=r},361:function(e,t,r){"use strict";var n,s=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),i=r(5),a=r(3),p=r(1),u=r(362),l=r(68),c=r(363),d=r(6),f=r(25),g=o.Immutable([f.ExpressionInputType.Attribute,f.ExpressionInputType.Expression]),h=function(e){function t(t){var r=e.call(this,t)||this;r.supportedDsTypes=o.Immutable([d.AllDataSourceTypes.FeatureLayer,d.AllDataSourceTypes.FeatureQuery]),r.embedTypeChange=function(e){var t=r.props.config;r.props.config.embedType!==e&&r.props.onSettingChange({id:r.props.id,config:t.set("embedType",e)})},r.checkURL=function(e){if(!e||""===e)return!1;if(!new RegExp("^(([h][t]{2}[p][s])?://)").test(e))return r.setState({urlError:r.formatMessage("httpsUrlMessage")}),!1;var t=e.indexOf(".");return!(t<0||t===e.length-1)||(r.setState({urlError:r.formatMessage("invalidUrlMessage")}),!1)},r.embedCodeChangeRightAway=function(e){var t=r.props,n=t.config,s=t.id;r.props.onSettingChange({config:n.set("embedCode",e),id:s})},r.formatMessage=function(e){return r.props.intl.formatMessage({id:e,defaultMessage:u.default[e]})},r.onDataSourceChange=function(e){e&&r.props.onSettingChange({id:r.props.id,useDataSources:e})},r.onToggleUseDataEnabled=function(e){r.props.onSettingChange({id:r.props.id,useDataSourcesEnabled:e})},r.openExpPopup=function(){return r.setState({isExpPopupOpen:!0})},r.closeExpPopup=function(){return r.setState({isExpPopupOpen:!1})},r.webAddressExpressionChange=function(e){var t=r.props,n=t.config;(0,t.onSettingChange)({id:t.id,config:n.set("expression",e)}),r.closeExpPopup()},r.staticUrlChange=function(e){var t,n={staticUrl:t=e&&e.target&&e.target.value?e.target.value.trim():"",showUrlError:!1};r.checkURL(t)||(n.showUrlError=!0),r.setState(n)},r.staticUrlSubmit=function(e){if(e)if(r.checkURL(e)){var t=r.props,n=t.config;(0,t.onSettingChange)({id:t.id,config:n.set("staticUrl",e)})}else r.setState({showUrlError:!0})},r.isUsedDataSource=function(){var e=r.props,t=e.useDataSources;return e.useDataSourcesEnabled&&t&&t.length>0};var n=t.config;return r.state={showUrlError:!1,urlError:"",isExpPopupOpen:!1,staticUrl:n.staticUrl},r}return s(t,e),t.prototype.render=function(){var e,t=this,n=this.props,s=n.theme,i=n.config,u=n.useDataSourcesEnabled,h=i.embedType,m=this.state.staticUrl;return o.jsx("div",{css:c.getStyle(this.props.theme)},o.jsx("div",{className:"widget-iframe jimu-widget"},o.jsx("div",null,o.jsx(a.SettingSection,null,o.jsx(a.SettingRow,{label:this.formatMessage("embedBy")}),o.jsx(a.SettingRow,null,o.jsx(p.Radio,{onChange:function(){return t.embedTypeChange(l.EmbedType.Url)},checked:h===l.EmbedType.Url}),o.jsx(p.Label,{className:"ml-2 ",onClick:function(e){return t.embedTypeChange(l.EmbedType.Url)}},this.formatMessage("websiteAddress"))),o.jsx(a.SettingRow,null,o.jsx(p.Radio,{onChange:function(){return t.embedTypeChange(l.EmbedType.Code)},checked:h===l.EmbedType.Code}),o.jsx(p.Label,{className:"ml-2 ",onClick:function(e){return t.embedTypeChange(l.EmbedType.Code)}},this.formatMessage("code"))),o.jsx(a.SettingRow,null,h===l.EmbedType.Url?o.jsx("div",{className:"d-flex flex-column w-100",style:{zIndex:3}},this.isUsedDataSource()?o.jsx(f.ExpressionInput,{useDataSources:this.props.useDataSources,fieldTypes:o.Immutable([o.JimuFieldType.String]),onChange:this.webAddressExpressionChange,expression:i.expression&&i.expression.asMutable({deep:!0}),placeHolders:(e={},e[f.ExpressionInputType.Attribute]=this.formatMessage("attributeHint"),e[f.ExpressionInputType.Expression]=this.formatMessage("expressionHint"),e),closeExpPopup:this.closeExpPopup,openExpPopup:this.openExpPopup,isExpPopupOpen:this.state.isExpPopupOpen,types:g}):o.jsx(p.TextInput,{invalid:this.state.showUrlError,type:"text",className:"w-100",placeholder:this.formatMessage("websitePlaceholder"),value:m,onChange:this.staticUrlChange,onAcceptValue:this.staticUrlSubmit,spellCheck:!1}),this.state.showUrlError&&o.jsx("div",{className:"d-flex w-100 align-items-center justify-content-between",style:{marginTop:"5px"}},o.jsx(p.Icon,{size:16,icon:r(364),color:s.colors.danger}),o.jsx("div",{style:{width:"calc(100% - 20px)",marginLeft:"4px",overflow:"hidden",textOverflow:"ellipsis",color:s.colors.danger}},this.state.urlError))):o.jsx(p.TextInput,{type:"textarea",style:{height:"300px"},className:"w-100",spellCheck:!1,placeholder:this.formatMessage("codePlaceholder"),value:i.embedCode||"",onAcceptValue:this.embedCodeChangeRightAway})),h===l.EmbedType.Url&&o.jsx(a.SettingRow,null,o.jsx("div",{className:"choose-ds w-100"},o.jsx(d.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.props.useDataSources,useDataSourcesEnabled:u,onToggleUseDataEnabled:this.onToggleUseDataEnabled,onChange:this.onDataSourceChange,widgetId:this.props.id})))))))},t.mapExtraStateProps=function(e,t){return{appConfig:e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig,appTheme:e&&e.appStateInBuilder&&e.appStateInBuilder.theme}},t}(i.BaseWidgetSetting);t.default=h},362:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={_widgetLabel:"Embed",websiteAddress:"Website address",code:"Code",invalidUrlMessage:"Invalid URL. Please check and try again.",httpsUrlMessage:"Only HTTPS is supported.",codePlaceholder:"Paste the HTML code from the site you want to embed.",websitePlaceholder:"Enter URL (HTTPS only)",embedBy:"Embed by",attributeHint:"URL from an attribute",expressionHint:"URL by an expression"}},363:function(e,t,r){"use strict";var n=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var s,o=r(0);t.getStyle=function(e){return o.css(s||(s=n(["\n    label {\n      cursor: pointer;\n    }\n  "],["\n    label {\n      cursor: pointer;\n    }\n  "])))}},364:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 32"><path d="M16.492 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zm0 21.333a2 2 0 11.001 3.999 2 2 0 01-.001-3.999zm0-2.666a2 2 0 01-2-2v-8a2 2 0 114 0v8a2 2 0 01-2 2z"></path></svg>'},5:function(e,t){e.exports=n},6:function(e,t){e.exports=s},68:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Url="url",e.Code="code"}(t.EmbedType||(t.EmbedType={}))}})}));